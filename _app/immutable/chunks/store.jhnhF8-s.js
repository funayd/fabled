import{w as f,k as q,l as we,e as E}from"./singletons.u-_GP5H4.js";import{B as a}from"./scheduler.A46dufu9.js";const Z={INT:/^-?[0-9]+$/,FLOAT:/^-?[0-9]+\.[0-9]+$/,SPACE:/^( +)/},I=i=>{i=i.replace(/\r\n/g,`
`).replace(/\n *\n/g,`
`).replace(/ +\n/g,`
`);const e=new l,t=0,s=i.split(`
`);return e.parse(s,t,0),e},R=i=>{const e=i.match(Z.SPACE);return e?e[1].length:0};class ve{data;constructor(e){this.data=e}set=e=>this.data=e;get=()=>this.data}class l{key;data={};constructor(e){this.key=e}put=(e,t)=>{this.data[e]=t};has=e=>this.data[e]!==void 0;get=(e,t,s)=>((this.data[e]=="[]"||this.data[e]==" []")&&(this.data[e]=JSON.parse(this.data[e].trim())),this.has(e)?s?s(this.data[e]):this.data[e]:t);getKeys=()=>Object.keys(this.data);remove=e=>{delete this.data[e]};parse=(e,t,s,n)=>{for(n&&(this.key=n);t<e.length&&R(e[t])>=s;){for(;t<e.length&&(R(e[t])!=s||e[t].replace(/ /g,"").charAt(0)=="#"||e[t].indexOf(":")==-1);)t++;if(t==e.length)break;let r=e[t].substring(s,e[t].indexOf(":"));if(r==="loaded"){t++;continue}if(r.match(/^["'].*["']$/)&&(r=r.substring(1,r.length-1)),!this.key&&!n&&(this.key=r),e[t].search(/: +\{\}/)!=-1&&e[t].length>=4)s===0&&console.log("empty section"),this.data[r]=new l(r);else if(t<e.length-1&&e[t+1].charAt(s)=="-"&&e[t+1].charAt(s+1)==" "&&R(e[t+1])==s){const o=[];for(;++t<e.length&&e[t].charAt(s)=="-";){let c=e[t].substring(s+2);(c.charAt(0)=="'"||c.charAt(0)=='"')&&(c=c.substring(1,c.length-1).replace(/\\(['"])/,h=>h.replace("\\",""))),o.push(c)}this.data[r]=o,t--}else if(t<e.length-1&&R(e[t+1])>s){t++;const o=R(e[t]),c=new l;t=c.parse(e,t,o,r)-1,this.data[r]=c}else{let o=e[t].substring(e[t].indexOf(":")+2);o.charAt(0)=="'"||o.charAt(0)=='"'?o=o.substring(1,o.length-1):isNaN(o)||(Z.INT.test(o)?o=parseInt(o):o=parseFloat(o)),typeof o=="string"&&(o.toLowerCase()=="false"?o=!1:o.toLowerCase()=="true"?o=!0:o=o.replace(/\\(['"])/,c=>c.replace("\\",""))),this.data[r]=o}do t++;while(t<e.length&&e[t].replace(/ /g,"").charAt(0)=="#")}return Object.keys(this.data).length==1&&this.key&&this.data[this.key]instanceof l&&(this.data=this.data[this.key].data),t};toString=()=>this.toYaml(this.key||this.data.name?"'"+(this.key||this.data.name)+"'":void 0,this.data);toYaml=(e,t,s=new ve("a"),n="")=>{if(t instanceof l)return t.toYaml("'"+(e??t.key)+"'",t.data,s,n);let r="";e&&(r+=n+e+`:
`,n+="  ");for(const o of Object.keys(t)){const c=t[o];let h="";if(c!=null){if(c instanceof Object)if(Object.keys(c).includes("toYaml"))if(c instanceof l){r+=c.toYaml("'"+o+"'",c.data,s,n);continue}else h=c.toYaml(n);else c instanceof Array&&(h=this.convertArray(o,s,n,c));else{const m=JSON.stringify(c);h=n+o+": "+m+`
`}h&&(r+=h.replaceAll(/(\\)?'/g,"\\'").replaceAll(/((\\)?")/g,m=>m.length==1?"'":m).replaceAll(/\\"/g,'"').replace(/\\\\/g,"\\"))}}return r};nextChar=e=>/z+/.test(e)?e.replaceAll(/z/g,"a")+"a":e.substring(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1);convertArray(e,t,s,n){if(e!="attributes"){let r=s+e+":";if(["string","number"].includes(typeof n[0]))n.length>0?(r+=`
`,n.forEach(o=>r+=s+"- "+JSON.stringify(o)+`
`)):r+=` []
`;else if(e==="components"||e==="children")if(n.length==0)r+=` {}
`;else return r+=`
`,n.forEach(o=>{const c=t.get();t.set(this.nextChar(t.get())),r+=this.toYaml(o.name+"-"+c,o.toYamlObj(),t,s+"  ")}),r.replaceAll(/'/g,'"');else r+=` []
`;return r}else return this.toYaml(e,n,t,s)}}class p{name;base;scale;constructor(e,t,s){this.name=e,this.base=t,this.scale=s}toYaml=(e="")=>e+this.name.toLowerCase()+"-base: "+this.base+`
`+e+this.name.toLowerCase()+"-scale: "+this.scale+`
`}class u{location="local";dataType="folder";key={};open=!1;name="Folder";data=[];parent;constructor(e){e&&(this.data=e,e.forEach(t=>{t instanceof u&&t.updateParent(this)}))}updateParent=e=>{this.parent=e};add=e=>{this.data.includes(e)||(e instanceof u&&(P(e,this.data),Ae(e),e.parent=this),this.data.push(e),this.sort())};remove=e=>{this.data=this.data.filter(t=>t!=e),this.sort()};sort=()=>{this.data=this.data.sort((e,t)=>{let s=0;return e instanceof u&&(t instanceof u||(s=-100)),e.name.localeCompare(t.name)+s}),$()};createFolder=()=>{const e=new u;P(e,this.data),this.data.push(e),this.sort(),e.updateParent(this)};deleteFolder=e=>{this.data=this.data.filter(t=>t!=e)};contains=e=>{if(this.data.includes(e))return!0;for(const t of this.data.filter(s=>s instanceof u))if(t.contains(e))return!0;return!1};getContainingFolder=e=>{if(this.data.includes(e))return this;for(const t of this.data.filter(s=>s instanceof u)){if(t.data.includes(e))return t;{const s=t.getContainingFolder(e);if(!s)continue;return s}}};getSubfolder=(e,t=!1)=>{for(const s of this.data.filter(n=>n instanceof u)){if(s.name===e)return s;if(t){const n=s.getSubfolder(e);if(!n)continue;return n}}}}const be=i=>i.replace("_"," ").toLowerCase().replace(/^(.)|\s(.)/g,e=>e.toUpperCase()),_=i=>(i=i.replace("_"," "),i.substring(0,1).toUpperCase()+i.substring(1).toLowerCase()),w=i=>i.sort((e,t)=>e.name.localeCompare(t.name)),ke=(i,e)=>{let t=e;localStorage.getItem(i)===null&&(typeof e=="string"||typeof e=="number"||typeof e=="boolean"?localStorage.setItem(i,e.toString()):localStorage.setItem(i,JSON.stringify(e))),typeof e=="number"?t=parseInt(localStorage.getItem(i)):typeof e=="boolean"?t=localStorage.getItem(i)==="true":typeof e=="string"?t=localStorage.getItem(i):t=JSON.parse(localStorage.getItem(i));const{subscribe:s,set:n,update:r}=f(t);return{subscribe:s,set:o=>(typeof o=="string"||typeof o=="number"||typeof o=="boolean"?localStorage.setItem(i,o.toString()):localStorage.setItem(i,JSON.stringify(o)),n(o)),update:r}};class Se{static new=()=>{throw new Error("'new' method not implemented")}}class Ie extends Se{type;name;description;comment;components=f([]);data=[];preview=[];enablePreview=!1;summaryItems=[];isParent=!0;isDeprecated=!1;id={};_defaultOpen=!1;parent;constructor(e,t){super(),this.type=e,this.name=t.name,this.description=t.description??"",this.summaryItems=t.summaryItems??[],this.comment=t.comment??"",this.setComponents(t.components||[]),this.data=t.data||[],this.preview=t.preview||[]}getValue(e){const t=this.data?.find(s=>s.key==e);return!t||!t.meetsRequirements(this)?"":t.getSummary()}setComponents=e=>{e.forEach(t=>t.parent=this),this.components.set([...e])};contains=e=>{const t=a(this.components);if(t.includes(e))return!0;for(const s of t)if(s.contains(e))return!0;return!1};addComponent=(e,t=-1)=>{const s=a(this.components);t==-1?s.push(e):s.splice(t,0,e),this.setComponents(s)};removeComponent=e=>{const t=a(this.components);if(t.includes(e)){t.splice(t.indexOf(e),1),e.parent=void 0,this.setComponents(t);return}for(const s of t)s.contains(e)&&s.removeComponent(e)};defaultOpen=()=>(this._defaultOpen=!0,this);toYamlObj(){const e=new l(this.name);if(e.put("type",this.type),e.put("comment",this.comment),this.preview.length>0){const t=new l("preview");t.put("enabled",this.enablePreview),this.preview.filter(s=>s.meetsPreviewRequirements(this)).forEach(s=>{const n=s.getData();Object.keys(n).forEach(r=>t.put(r,n[r]))}),e.put("preview",t)}return e}getRawPreviewData(){const e=new l("preview");return this.preview.forEach(t=>{const s=t.getData();Object.keys(s).forEach(n=>e.put(n,s[n]))}),e}deserialize(e){const t=e.get("preview");t&&(this.enablePreview=t.get("enabled",!1),this.preview.forEach(s=>s.deserialize(t))),this.comment=e.get("comment","").replaceAll("\\n",`
`)}}const ee=f({}),te=f({}),se=f({}),ie=f({}),ne=f(!1),B=f(""),Ce=q([ee,B],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),Je=q(Ce,i=>{const e={};return i.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),Ue=q([te,B],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),je=q([se,B],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),ye=q([ie,B],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),Qe=q(ye,i=>{const e={};return i.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e});class C{static getTriggerByName=e=>Object.values(a(ee)).find(s=>s.name.toLowerCase()===e.toLowerCase()||s.alias?.toLowerCase()===e.toLowerCase())?.component;static getTargetByName=e=>Object.values(a(te)).find(s=>s.name.toLowerCase()===e.toLowerCase()||s.alias?.toLowerCase()===e.toLowerCase())?.component;static getConditionByName=e=>Object.values(a(se)).find(s=>s.name.toLowerCase()===e.toLowerCase()||s.alias?.toLowerCase()===e.toLowerCase())?.component;static getMechanicByName=e=>Object.values(a(ie)).find(s=>s.name.toLowerCase()===e.toLowerCase()||s.alias?.toLowerCase()===e.toLowerCase())?.component;static deserializeComponents=e=>{if(!e||!(e instanceof l))return[];const t=[],s=e.getKeys();for(const n of s){let r;const o=e.get(n),c=o.get("type");if(c==="trigger"){const h=C.getTriggerByName(n.split("-")[0]);h&&(r=h.new())}else if(c==="target"){const h=C.getTargetByName(n.split("-")[0]);h&&(r=h.new())}else if(c==="condition"){const h=C.getConditionByName(n.split("-")[0]);h&&(r=h.new())}else if(c==="mechanic"){const h=C.getMechanicByName(n.split("-")[0]);h&&(r=h.new())}r&&(r.deserialize(o),t.push(r))}return t}}class T extends Ie{mana=!1;cooldown=!1;constructor(e,t=!1){super("trigger",e),this.mana=e.mana||!1,this.cooldown=e.cooldown||!1,super.isDeprecated=t}clone=()=>new T({name:this.name,components:[...a(this.components)],mana:this.mana,cooldown:this.cooldown,data:[...this.data],preview:[...this.preview],comment:this.comment,description:this.description,summaryItems:[...this.summaryItems]});toYamlObj(){const e=super.toYamlObj(),t=this.getData();t.getKeys().length>0&&e.put("data",t);const s=a(this.components);return s.length>0&&e.put("children",s),e}getData(){const e=new l("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(e.put("mana",this.mana),e.put("cooldown",this.cooldown)),this.data.filter(t=>t.meetsRequirements(this)).forEach(t=>{const s=t.getData();Object.keys(s).forEach(n=>e.put(n,s[n]))}),e}getRawData(){const e=new l("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(e.put("mana",this.mana),e.put("cooldown",this.cooldown)),this.data.forEach(t=>{const s=t.getData();Object.keys(s).forEach(n=>e.put(n,s[n]))}),e}deserialize(e){super.deserialize(e);const t=e.get("data");t&&(this.mana=t.get("mana",!1),this.cooldown=t.get("cooldown",!1),this.data.forEach(s=>s.deserialize(t))),this.setComponents(e.get("children",[],s=>C.deserializeComponents(s)))}static new=()=>new T({name:"null"})}class b{dataType="skill";location="local";loaded=!1;isSkill=!0;key={};name;previousName="";type="Dynamic";maxLevel=5;skillReq;skillReqLevel=0;attributeRequirements=[];permission=!1;levelReq=new p("level",1,0);cost=new p("cost",1,0);cooldown=new p("cooldown",0,0);cooldownMessage=!0;mana=new p("mana",0,0);minSpent=new p("points-spent-req",0,0);castMessage="&6{player} &2has cast &6{skill}";combo="";icon={material:"Pumpkin",customModelData:0,lore:["&d{name} &7({level}/{max})","&2Type: &6{type}","","{req:level}Level: {attr:level}","{req:cost}Cost: {attr:cost}","","&2Mana: {attr:mana}","&2Cooldown: {attr:cooldown}"]};incompatible=[];triggers=[];skillReqStr="";incompStr=[];constructor(e){this.name=e?.name||"Skill",e&&(e.location&&(this.location=e.location),e.type&&(this.type=e.type),e.maxLevel&&(this.maxLevel=e.maxLevel),e.skillReq&&(this.skillReq=e.skillReq),e.skillReqLevel&&(this.skillReqLevel=e.skillReqLevel),e.attributeRequirements&&(this.attributeRequirements=e.attributeRequirements.map(t=>new p(t.name,t.base,t.scale))),e.permission&&(this.permission=e.permission),e.levelReq&&(this.levelReq=e.levelReq),e.cost&&(this.cost=e.cost),e.cooldown&&(this.cooldown=e.cooldown),e.cooldownMessage&&(this.cooldownMessage=e.cooldownMessage),e.mana&&(this.mana=e.mana),e.minSpent&&(this.minSpent=e.minSpent),e.castMessage&&(this.castMessage=e.castMessage),e.combo&&(this.combo=e.combo),e.icon&&(this.icon=e.icon),e.incompatible&&(this.incompatible=e.incompatible),e.triggers&&(this.triggers=e.triggers))}addComponent=e=>{if(e instanceof T){this.triggers=[...this.triggers,e];return}this.triggers.length===0&&this.triggers.push(C.getTriggerByName("cast")?.new()),this.triggers[0].addComponent(e),this.triggers=[...this.triggers]};removeComponent=e=>{if(e instanceof T&&this.triggers.includes(e)){this.triggers.splice(this.triggers.indexOf(e),1);return}for(const t of this.triggers)t.contains(e)&&t.removeComponent(e);this.triggers=[...this.triggers]};serializeYaml=()=>{const e=new l(this.name),t=new l;t.put("name",this.name),t.put("type",this.type),t.put("max-level",this.maxLevel),t.put("skill-req",this.skillReq?.name),t.put("skill-req-lvl",this.skillReqLevel),t.put("needs-permission",this.permission),t.put("cooldown-message",this.cooldownMessage),t.put("msg",this.castMessage),t.put("combo",this.combo),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore);const s=new l("attributes");return s.put("level",this.levelReq),s.put("cost",this.cost),s.put("cooldown",this.cooldown),s.put("mana",this.mana),s.put("points-spent-req",this.minSpent),s.put("incompatible",this.incompatible.map(n=>n.name)),this.attributeRequirements.forEach(n=>s.put(n.name.toLowerCase(),n)),t.put("attributes",s),t.put("components",this.triggers),e.data=t.data,e};load=e=>{this.name=e.get("name",this.name),this.type=e.get("type",this.type),this.maxLevel=e.get("max-level",this.maxLevel),this.skillReqStr=e.get("skill-req",this.skillReqStr),this.skillReqLevel=e.get("skill-req-lvl",this.skillReqLevel),this.permission=e.get("needs-permission",this.permission),this.cooldownMessage=e.get("cooldown-message",this.cooldownMessage),this.castMessage=e.get("msg",this.castMessage),this.combo=e.get("combo",this.combo);const t=e.get("attributes");this.levelReq=new p("level",t.get("level-base"),t.get("level-scale")),this.cost=new p("cost",t.get("cost-base"),t.get("cost-scale")),this.cooldown=new p("cooldown",t.get("cooldown-base"),t.get("cooldown-scale")),this.mana=new p("mana",t.get("mana-base"),t.get("mana-scale")),this.minSpent=new p("points-spent-req",t.get("points-spent-req-base"),t.get("points-spent-req-scale")),this.incompStr=t.get("incompatible",this.incompStr);const s=["level","cost","cooldown","mana","points-spent-req","incompatible"],n=new Set(t.getKeys().map(o=>o.replace(/-(base|scale)/i,"")).filter(o=>!s.includes(o)));this.attributeRequirements=[...n].map(o=>new p(o,t.get(o+"-base"),t.get(o+"-scale"))),this.icon.material=e.get("icon",this.icon.material,_),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore);let r;r=ne.subscribe(o=>{o&&(this.triggers=e.get("components",this.triggers,c=>C.deserializeComponents(c)),r&&r())}),this.loaded=!0};postLoad=()=>{this.skillReq=L(this.skillReqStr),this.incompatible=this.incompStr.map(e=>L(e)).filter(e=>!!e)};save=()=>{if(!this.name)return;const e=this.serializeYaml();this.location!=="server"&&(this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.skill."+this.previousName),this.previousName=this.name,localStorage.setItem("sapi.skill."+this.name,e.toString()))}}const A=we("goto");let oe=!1;const Le=i=>{const e=[],t=I(i);let s;if(t.key&&!t.data[t.key]){const n=t.key;return n==="loaded"||(s=new b({name:n}),s.load(t),e.push(s)),e}for(const n in t.data)n!="loaded"&&t.data[n]instanceof l&&(s=new b({name:n}),s.load(t.data[n]),e.push(s));return e},re=(i,e,t,s,n)=>{let r=e;{const m=localStorage.getItem(i);m&&(r=t(m),n&&n(r))}const{subscribe:o,set:c,update:h}=f(r);return{subscribe:o,set:m=>(s&&(m=s(m)),c(m)),update:h}},d=re(localStorage.getItem("skillNames")?"skillNames":"skillData",[],i=>localStorage.getItem("skillNames")?i.split(", ").map(e=>new b({name:e,location:"local"})).filter(e=>localStorage.getItem("sapi.skill."+e.name)):(localStorage.removeItem("skillData"),oe=!0,w(Le(i))),i=>(ce(),w(i))),L=i=>{for(const e of a(d))if(e.name==i)return e},k=re("skillFolders",[],i=>!i||i==="null"?[]:JSON.parse(i,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return L(s);const n=new u(s.data);return n.name=s.name,n}return s}}),i=>{const e=JSON.stringify(i,(t,s)=>s instanceof b||s instanceof b?s.name:t==="parent"?void 0:s);return localStorage.setItem("skillFolders",e),w(i)}),W=i=>!!L(i),V=i=>{const e=a(d);let t=e.length+1;for(;!i&&W(i||"Skill "+t);)t++;const s=new b({name:i||"Skill "+t});return e.push(s),d.set(e),s.save(),s},ae=i=>{i.loaded||(i.location==="local"&&i.load(I(localStorage.getItem(`sapi.skill.${i.name}`)||"")),i.postLoad())},Ge=i=>{i.loaded||ae(i);const e=a(d);let t=i.name+" (Copy)",s=1;for(;W(t);)t=i.name+" (Copy "+s+")",s++;const n=new b;return n.load(I(i.serializeYaml().toString())),n.name=t,e.push(n),d.set(e),n.save(),n},Ke=i=>{const e=a(k);e.includes(i)||(P(i,e),e.push(i),e.sort((t,s)=>t.name.localeCompare(s.name)),k.set(e))},le=(i,e)=>{const t=a(k).filter(s=>s!=i);i.data.forEach(s=>{if(s instanceof u){if(e&&e(s)){le(s,e);return}i.parent?i.parent.add(s):(s.updateParent(),t.push(s))}else i.parent&&i.parent.add(s)}),k.set(t)},qe=i=>{const e=a(d).filter(s=>s!=i),t=a(O);d.set(e),localStorage.removeItem("sapi.skill."+i.name),t instanceof b&&(e.length===0?A(`${E}/`):e.find(s=>s===a(O))||A(`${E}/skill/${e[0].name}`))},x=()=>d.set(w(a(d))),Oe=()=>{k.set(w(a(k))),x()},Q=(i,e=!1)=>{const t=I(i);console.log(t);let s;if(t.key&&!t.data[t.key]){const n=t.key;s=W(n)?L(n):V(n),e&&(s.location="server"),s.load(t),s.save(),x();return}for(const n in t.data)n!="loaded"&&t.data[n]instanceof l&&!W(n)&&(s=W(n)?L(n):V(n),s.load(t.data[n]),s.save());x()},Ne=i=>{const e=i.target?.result;e&&Q(e)},J=f(!1);let U;const ce=i=>{a(J)&&U&&clearTimeout(U),J.set(!0),U=setTimeout(()=>{const e=(i||a(d)).filter(t=>t.location==="local");localStorage.setItem("skillNames",e.map(t=>t.name).join(", ")),J.set(!1)})};a(d).forEach(i=>{i.loaded&&i.postLoad()});if(oe){const i=ne.subscribe(e=>{e&&(a(d).forEach(t=>{t.location==="local"&&t.save()}),ce(),i&&i())})}class v{dataType="class";location="local";loaded=!1;isClass=!0;key={};name;previousName="";prefix="";group="class";manaName="&2Mana";maxLevel=40;parentStr="";_parent;get parent(){return this._parent}set parent(e){this._parent=e,this.parentStr=e?e.name:""}permission=!1;expSources=273;manaRegen=1;health=new p("health",20,1);mana=new p("mana",20,1);attributes=[];skillTree="Requirement";skills=[];icon={material:"Pumpkin",customModelData:0};unusableItems=[];actionBar="";lInverted=!1;rInverted=!1;lsInverted=!1;rsInverted=!1;pInverted=!1;qInverted=!1;fInverted=!1;lWhitelist=[];rWhitelist=[];lsWhitelist=[];rsWhitelist=[];pWhitelist=[];qWhitelist=[];fWhitelist=[];constructor(e){this.name=e?e.name:"Class",this.prefix=e?.prefix?e.prefix:"&6"+this.name,e&&(e?.location&&(this.location=e.location),e?.group&&(this.group=e.group),e?.manaName&&(this.manaName=e.manaName),e?.maxLevel&&(this.maxLevel=e.maxLevel),e?.parent&&(this.parent=e.parent),e?.permission&&(this.permission=e.permission),e?.expSources&&(this.expSources=e.expSources),e?.health&&(this.health=e.health),e?.mana&&(this.mana=e.mana),e?.manaRegen&&(this.manaRegen=e.manaRegen),e?.attributes&&(this.attributes=e.attributes),e?.skillTree&&(this.skillTree=e.skillTree),e?.skills&&(this.skills=e.skills),e?.icon&&(this.icon=e.icon),e?.unusableItems&&(this.unusableItems=e.unusableItems),e?.actionBar&&(this.actionBar=e.actionBar),e?.lInverted&&(this.lInverted=e.lInverted),e?.rInverted&&(this.rInverted=e.rInverted),e?.lsInverted&&(this.lsInverted=e.lsInverted),e?.rsInverted&&(this.rsInverted=e.rsInverted),e?.pInverted&&(this.pInverted=e.pInverted),e?.qInverted&&(this.qInverted=e.qInverted),e?.fInverted&&(this.fInverted=e.fInverted),e?.lWhitelist&&(this.lWhitelist=e.lWhitelist),e?.rWhitelist&&(this.rWhitelist=e.rWhitelist),e?.lsWhitelist&&(this.lsWhitelist=e.lsWhitelist),e?.rsWhitelist&&(this.rsWhitelist=e.rsWhitelist),e?.pWhitelist&&(this.pWhitelist=e.pWhitelist),e?.qWhitelist&&(this.qWhitelist=e.qWhitelist),e?.fWhitelist&&(this.fWhitelist=e.fWhitelist))}updateAttributes=e=>{const t=[];this.attributes=this.attributes.filter(s=>e?.includes(s.name)?(t.push(s.name),!0):!1),e=e.filter(s=>!t.includes(s));for(const s of e)this.attributes.push(new p(s,0,0))};serializeYaml=()=>{const e=new l(this.name),t=new l;t.put("name",this.name),t.put("action-bar",this.actionBar),t.put("prefix",this.prefix),t.put("group",this.group),t.put("mana",this.manaName),t.put("max-level",this.maxLevel),t.put("parent",this.parent?.name||""),t.put("needs-permission",this.permission),t.put("attributes",[this.health,this.mana,...this.attributes]),t.put("mana-regen",this.manaRegen),t.put("skill-tree",this.skillTree.toUpperCase().replace(/ /g,"_")),t.put("blacklist",this.unusableItems),t.put("skills",this.skills.map(N=>N.name)),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore),t.put("exp-source",this.expSources);const s=new l("combo-starters"),n=new l("L");n.put("inverted",this.lInverted),n.put("whitelist",this.lWhitelist),s.put("L",n);const r=new l("R");r.put("inverted",this.rInverted),r.put("whitelist",this.rWhitelist),s.put("R",r);const o=new l("LS");o.put("inverted",this.lsInverted),o.put("whitelist",this.lsWhitelist),s.put("LS",o);const c=new l("RS");c.put("inverted",this.rsInverted),c.put("whitelist",this.rsWhitelist),s.put("RS",c);const h=new l("P");h.put("inverted",this.pInverted),h.put("whitelist",this.pWhitelist),s.put("P",h);const m=new l("Q");m.put("inverted",this.qInverted),m.put("whitelist",this.qWhitelist),s.put("Q",m);const y=new l("F");return y.put("inverted",this.fInverted),y.put("whitelist",this.fWhitelist),s.put("F",y),t.put("combo-starters",s),e.data=t.data,e};updateParent=e=>{this.parentStr&&(this.parent=e.find(t=>t.name===this.parentStr))};load=e=>{this.name=e.get("name",this.name),this.actionBar=e.get("action-bar",this.actionBar),this.manaName=e.get("mana",this.manaName),this.prefix=e.get("prefix",this.prefix),this.group=e.get("group",this.group),this.maxLevel=e.get("max-level",this.maxLevel),this.parentStr=e.get("parent",this.parentStr),this.permission=e.get("needs-permission",this.permission),this.attributes=e.get("attributes",this.attributes,s=>{const n=[],r=s.get("health-base",20),o=s.get("health-scale",1),c=s.get("mana-base",20),h=s.get("mana-scale",1);this.health=new p("health",r,o),this.mana=new p("mana",c,h),s.remove("health-base"),s.remove("health-scale"),s.remove("mana-base"),s.remove("mana-scale");const m={};return Object.keys(s.data).forEach(y=>{const N=y.split("-"),F=N[0];m[F]||(m[F]=new p(F,0,0));const K=m[F];N[1]=="base"&&(K.base=Number.parseFloat(s.data[y])),N[1]=="scale"&&(K.scale=Number.parseFloat(s.data[y]))}),n.push(...Object.values(m)),n}),this.manaRegen=e.get("mana-regen",this.manaRegen),this.skillTree=e.get("skill-tree",this.skillTree,be),this.unusableItems=e.get("blacklist",this.unusableItems),this.skills=e.get("skills",this.skills,s=>s.map(n=>L(n)).filter(n=>!!n)),this.icon.material=e.get("icon",this.icon.material,_),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore),this.expSources=e.get("exp-source",this.expSources);const t=e.get("combo-starters",new l);this.lInverted=t.get("L",new l).get("inverted",this.lInverted),this.rInverted=t.get("R",new l).get("inverted",this.rInverted),this.lsInverted=t.get("LS",new l).get("inverted",this.lsInverted),this.rsInverted=t.get("RS",new l).get("inverted",this.rsInverted),this.pInverted=t.get("P",new l).get("inverted",this.pInverted),this.qInverted=t.get("Q",new l).get("inverted",this.qInverted),this.fInverted=t.get("F",new l).get("inverted",this.fInverted),this.lWhitelist=t.get("L",new l).get("whitelist",this.lWhitelist),this.rWhitelist=t.get("R",new l).get("whitelist",this.rWhitelist),this.lsWhitelist=t.get("LS",new l).get("whitelist",this.lsWhitelist),this.rsWhitelist=t.get("RS",new l).get("whitelist",this.rsWhitelist),this.pWhitelist=t.get("P",new l).get("whitelist",this.pWhitelist),this.qWhitelist=t.get("Q",new l).get("whitelist",this.qWhitelist),this.fWhitelist=t.get("F",new l).get("whitelist",this.fWhitelist),this.loaded=!0};save=()=>{if(!this.name||this.location==="server")return;const e=this.serializeYaml();this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.class."+this.previousName),this.previousName=this.name,localStorage.setItem("sapi.class."+this.name,e.toString())}}let he=!1;const Re=i=>{const e=[],t=I(i);let s;if(t.key&&!t.data[t.key]){const n=t.key;return n==="loaded"||(s=new v({name:n}),s.load(t),e.push(s)),e}for(const n in t.data)n!="loaded"&&t.data[n]instanceof l&&(s=new v({name:n}),s.load(t.data[n]),e.push(s));return e},me=(i,e,t,s,n)=>{let r=e;{const m=localStorage.getItem(i);m&&(r=t(m),n&&n(r))}const{subscribe:o,set:c,update:h}=f(r);return{subscribe:o,set:m=>(s&&(m=s(m)),c(m)),update:h}},g=me(localStorage.getItem("classNames")?"classNames":"classData",[],i=>localStorage.getItem("classNames")?i.split(", ").map(e=>new v({name:e,location:"local"})).filter(e=>localStorage.getItem("sapi.class."+e.name)):(localStorage.removeItem("classData"),he=!0,w(Re(i))),i=>(ue(i),i.forEach(e=>e.updateParent(i)),w(i)),i=>i.forEach(e=>e.updateParent(i))),M=i=>{for(const e of a(g))if(e.name==i)return e},S=me("classFolders",[],i=>!i||i==="null"?[]:JSON.parse(i,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return M(s);const n=new u(s.data);return n.name=s.name,n}return s}}),i=>{const e=JSON.stringify(i,(t,s)=>s instanceof v||s instanceof b?s.name:t==="parent"?void 0:s);return localStorage.setItem("classFolders",e),w(i)}),H=i=>a(g).forEach(e=>e.updateAttributes(i)),D=i=>!!M(i),X=i=>{const e=a(g);let t=e.length+1;for(;!i&&D(i||"Class "+t);)t++;const s=new v({name:i||"Class "+t});return e.push(s),g.set(e),s.save(),s},pe=i=>{i.loaded||(i.location==="local"&&i.load(I(localStorage.getItem(`sapi.class.${i.name}`)||"")),i.updateParent(a(g)),i.loaded=!0)},Ve=i=>{i.loaded||pe(i);const e=a(g);let t=i.name+" (Copy)",s=1;for(;D(t);)t=i.name+" (Copy "+s+")",s++;const n=new v;return n.load(I(i.serializeYaml().toString())),n.name=t,e.push(n),g.set(e),n.save(),n},He=i=>{const e=a(S);e.includes(i)||(P(i,e),e.push(i),e.sort((t,s)=>t.name.localeCompare(s.name)),S.set(e))},fe=(i,e)=>{const t=a(S).filter(s=>s!=i);i.data.forEach(s=>{if(s instanceof u){if(e&&e(s)){fe(s,e);return}i.parent?i.parent.add(s):(s.updateParent(),t.push(s))}else i.parent&&i.parent.add(s)}),S.set(t)},We=i=>{const e=a(g).filter(s=>s!=i),t=a(O);g.set(e),localStorage.removeItem("sapi.class."+i.name),t instanceof v&&(e.length===0?A(`${E}/`):e.find(s=>s===a(O))||A(`${E}/class/${e[0].name}/edit`))},Y=()=>g.set(w(a(g))),De=()=>{S.set(w(a(S))),Y()},G=(i,e=!1)=>{const t=I(i);let s;if(t.key&&!t.data[t.key]){const n=t.key;s=D(n)?M(n):X(n),e&&(s.location="server"),s.load(t),Y();return}for(const n in t.data)n!="loaded"&&t.data[n]instanceof l&&!D(n)&&(s=D(n)?M(n):X(n),s.load(t.data[n]));Y()},Te=i=>{const e=i.target?.result;e&&G(e)},ue=i=>{const e=(i||a(g)).filter(t=>t.location==="local");localStorage.setItem("classNames",e.map(t=>t.name).join(", "))};he&&(a(g).forEach(i=>{i.location==="local"&&i.save()}),ue());const ze=(()=>{let i=["vitality","spirit","intelligence","dexterity","strength"];{const n=localStorage.getItem("attribs");n&&(i=n.split(","),H(i))}const{subscribe:e,set:t,update:s}=f(i);return{subscribe:e,set:n=>(localStorage.setItem("attribs",n.join(",")),H(n),t(n)),update:s}})(),ge=i=>{const e=I(i),t=Object.keys(e.data);ze.set(t)},O=f(void 0),Fe=q(O,i=>i instanceof v?"class":"skill"),Xe=f(),Ze=f(),z=ke("sidebarOpen",!0),_e=f(!0),de=f(!0),Ee=f(!1),et=()=>{a(z)&&(a(Fe)=="class"?Y():x(),$())},tt=()=>z.set(!a(z)),st=()=>z.set(!1),it=i=>Ee.set(i),P=(i,e)=>{const t=i.name;let s=1;for(;e.filter(n=>n instanceof u&&n.name==i.name).length>=1;)i.name=t+" ("+s+++")"},nt=i=>{i.parent?(i.parent.deleteFolder(i),$()):a(de)?fe(i,()=>!1):le(i,()=>!1)},ot=i=>{i&&(xe(i)?.remove(i),i instanceof v?We(i):qe(i),$())},$=()=>{a(z)&&(a(de)?De():Oe())},Ae=i=>{const e=a(S),t=a(k);e.includes(i)&&S.set(e.filter(s=>s!=i)),t.includes(i)&&k.set(t.filter(s=>s!=i))},xe=i=>{if(!i)return;if(i instanceof u)return i.parent;const e=i instanceof v?a(S):a(k);for(const t of e){const s=t.getContainingFolder(i);if(s)return s}},Me=i=>{const e=i.target?.result;e&&(e.indexOf("global:")>=0?ge(e):e.indexOf("components:")>=0||e.indexOf("group:")==-1&&e.indexOf("combo:")==-1&&e.indexOf("skills:")==-1?Q(e):G(e),document.activeElement.blur())},rt=(i,e=!1)=>{i&&(i.indexOf("global:")>=0?ge(i):i.indexOf("components:")>=0||i.indexOf("group:")==-1&&i.indexOf("combo:")==-1&&i.indexOf("skills:")==-1?(console.log("loading skills"),Q(i.replace(`loaded: false
`,""),e)):(console.log("loading classes"),G(i.replace(`loaded: false
`,""),e)))},at=i=>{const e=new FileReader;i.name.indexOf("skills")==0?e.onload=Ne:i.name.indexOf("classes")==0?e.onload=Te:e.onload=Me,e.readAsText(i)},lt=i=>{const e=i||a(O);e&&j(e.name+".yml",e.serializeYaml().toString())},Ye=()=>{const i=a(d);i.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new l;e.put("loaded",!1);for(const t of i)t.loaded||ae(t),e.put(t.name,t.serializeYaml());return e},Pe=()=>{const i=a(g);i.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new l;e.put("loaded",!1);for(const t of i)t.loaded||pe(t),e.put(t.name,t.serializeYaml());return e},ct=async()=>{const i=Ye(),e=Pe();j("skills.yml",i.toString()),j("classes.yml",e.toString())},j=(i,e)=>{const t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=i,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)};export{Ie as $,Ke as A,Ve as B,Ge as C,lt as D,ot as E,nt as F,Ae as G,S as H,k as I,X as J,V as K,st as L,J as M,ct as N,z as O,p as P,Ee as Q,I as R,B as S,Ue as T,je as U,ye as V,Qe as W,Ze as X,C as Y,l as Z,Je as _,at as a,ze as a0,et as a1,be as a2,ke as a3,Fe as b,O as c,g as d,v as e,M as f,A as g,d as h,b as i,L as j,ee as k,rt as l,te as m,se as n,ie as o,ne as p,T as q,xe as r,it as s,tt as t,_e as u,Xe as v,$ as w,u as x,de as y,He as z};
