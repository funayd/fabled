import{w as p,k as q,l as ve,e as A}from"./singletons.HEd31L4d.js";import{B as r}from"./scheduler.ffkzYN6j.js";const _={INT:/^-?[0-9]+$/,FLOAT:/^-?[0-9]+\.[0-9]+$/,SPACE:/^( +)/},I=i=>{i=i.replace(/\r\n/g,`
`).replace(/\n *\n/g,`
`).replace(/ +\n/g,`
`);const e=new l,t=0,s=i.split(`
`);return e.parse(s,t,0),e},R=i=>{const e=i.match(_.SPACE);return e?e[1].length:0};class be{data;constructor(e){this.data=e}set=e=>this.data=e;get=()=>this.data}class l{key;data={};constructor(e){this.key=e}put=(e,t)=>{this.data[e]=t};has=e=>this.data[e]!==void 0;get=(e,t,s)=>((this.data[e]=="[]"||this.data[e]==" []")&&(this.data[e]=JSON.parse(this.data[e].trim())),this.has(e)?s?s(this.data[e]):this.data[e]:t);getKeys=()=>Object.keys(this.data);remove=e=>{delete this.data[e]};parse=(e,t,s,n)=>{for(n&&(this.key=n);t<e.length&&R(e[t])>=s;){for(;t<e.length&&(R(e[t])!=s||e[t].replace(/ /g,"").charAt(0)=="#"||e[t].indexOf(":")==-1);)t++;if(t==e.length)break;let a=e[t].substring(s,e[t].indexOf(":"));if(a==="loaded"){t++;continue}if(a.match(/^["'].*["']$/)&&(a=a.substring(1,a.length-1)),!this.key&&!n&&(this.key=a),e[t].search(/: +\{\}/)!=-1&&e[t].length>=4)s===0&&console.log("empty section"),this.data[a]=new l(a);else if(t<e.length-1&&e[t+1].charAt(s)=="-"&&e[t+1].charAt(s+1)==" "&&R(e[t+1])==s){const o=[];for(;++t<e.length&&e[t].charAt(s)=="-";){let c=e[t].substring(s+2);(c.charAt(0)=="'"||c.charAt(0)=='"')&&(c=c.substring(1,c.length-1).replace(/\\(['"])/,h=>h.replace("\\",""))),o.push(c)}this.data[a]=o,t--}else if(t<e.length-1&&R(e[t+1])>s){t++;const o=R(e[t]),c=new l;t=c.parse(e,t,o,a)-1,this.data[a]=c}else{let o=e[t].substring(e[t].indexOf(":")+2);o.charAt(0)=="'"||o.charAt(0)=='"'?o=o.substring(1,o.length-1):isNaN(o)||(_.INT.test(o)?o=parseInt(o):o=parseFloat(o)),typeof o=="string"&&(o.toLowerCase()=="false"?o=!1:o.toLowerCase()=="true"?o=!0:o=o.replace(/\\(['"])/,c=>c.replace("\\",""))),this.data[a]=o}do t++;while(t<e.length&&e[t].replace(/ /g,"").charAt(0)=="#")}return Object.keys(this.data).length==1&&this.key&&this.data[this.key]instanceof l&&(this.data=this.data[this.key].data),t};toString=()=>this.toYaml(this.key||this.data.name?"'"+(this.key||this.data.name)+"'":void 0,this.data);toYaml=(e,t,s=new be("a"),n="")=>{if(t instanceof l)return t.toYaml("'"+(e??t.key)+"'",t.data,s,n);let a="";e&&(a+=n+e+`:
`,n+="  ");for(const o of Object.keys(t)){const c=t[o];let h="";if(c!=null){if(c instanceof Object)if(Object.keys(c).includes("toYaml"))if(c instanceof l){a+=c.toYaml("'"+o+"'",c.data,s,n);continue}else h=c.toYaml(n);else c instanceof Array&&(h=this.convertArray(o,s,n,c));else{const m=JSON.stringify(c);h=n+o+": "+m+`
`}h&&(a+=h.replaceAll(/(\\)?'/g,"\\'").replaceAll(/((\\)?")/g,m=>m.length==1?"'":m).replaceAll(/\\"/g,'"').replace(/\\\\/g,"\\"))}}return a};nextChar=e=>/z+/.test(e)?e.replaceAll(/z/g,"a")+"a":e.substring(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1);convertArray(e,t,s,n){if(e!="attributes"){let a=s+e+":";if(["string","number"].includes(typeof n[0]))n.length>0?(a+=`
`,n.forEach(o=>a+=s+"- "+JSON.stringify(o)+`
`)):a+=` []
`;else if(e==="components"||e==="children")if(n.length==0)a+=` {}
`;else return a+=`
`,n.forEach(o=>{const c=t.get();t.set(this.nextChar(t.get())),a+=this.toYaml(o.name+"-"+c,o.toYamlObj(),t,s+"  ")}),a.replaceAll(/'/g,'"');else a+=` []
`;return a}else return this.toYaml(e,n,t,s)}}class f{name;base;scale;constructor(e,t,s){this.name=e,this.base=t,this.scale=s}toYaml=(e="")=>e+this.name.toLowerCase()+"-base: "+this.base+`
`+e+this.name.toLowerCase()+"-scale: "+this.scale+`
`}class u{location="local";dataType="folder";key={};open=!1;name="Folder";data=[];parent;constructor(e){e&&(this.data=e,e.forEach(t=>{t instanceof u&&t.updateParent(this)}))}updateParent=e=>{this.parent=e};add=e=>{this.data.includes(e)||(e instanceof u&&(P(e,this.data),xe(e),e.parent=this),this.data.push(e),this.sort())};remove=e=>{this.data=this.data.filter(t=>t!=e),this.sort()};sort=()=>{this.data=this.data.sort((e,t)=>{let s=0;return e instanceof u&&(t instanceof u||(s=-100)),e.name.localeCompare(t.name)+s}),J()};createFolder=()=>{const e=new u;P(e,this.data),this.data.push(e),this.sort(),e.updateParent(this)};deleteFolder=e=>{this.data=this.data.filter(t=>t!=e)};contains=e=>{if(this.data.includes(e))return!0;for(const t of this.data.filter(s=>s instanceof u))if(t.contains(e))return!0;return!1};getContainingFolder=e=>{if(this.data.includes(e))return this;for(const t of this.data.filter(s=>s instanceof u)){if(t.data.includes(e))return t;{const s=t.getContainingFolder(e);if(!s)continue;return s}}};getSubfolder=(e,t=!1)=>{for(const s of this.data.filter(n=>n instanceof u)){if(s.name===e)return s;if(t){const n=s.getSubfolder(e);if(!n)continue;return n}}}}const ke=i=>i.replace("_"," ").toLowerCase().replace(/^(.)|\s(.)/g,e=>e.toUpperCase()),ee=i=>(i=i.replace("_"," "),i.substring(0,1).toUpperCase()+i.substring(1).toLowerCase()),w=i=>i.sort((e,t)=>e.name.localeCompare(t.name)),Se=(i,e)=>{let t=e;localStorage.getItem(i)===null&&(typeof e=="string"||typeof e=="number"||typeof e=="boolean"?localStorage.setItem(i,e.toString()):localStorage.setItem(i,JSON.stringify(e))),typeof e=="number"?t=parseInt(localStorage.getItem(i)):typeof e=="boolean"?t=localStorage.getItem(i)==="true":typeof e=="string"?t=localStorage.getItem(i):t=JSON.parse(localStorage.getItem(i));const{subscribe:s,set:n,update:a}=p(t);return{subscribe:s,set:o=>(typeof o=="string"||typeof o=="number"||typeof o=="boolean"?localStorage.setItem(i,o.toString()):localStorage.setItem(i,JSON.stringify(o)),n(o)),update:a}};class Ie{static new=()=>{throw new Error("'new' method not implemented")}}class Ce extends Ie{type;name;description;comment;components=p([]);data=[];preview=[];enablePreview=!1;summaryItems=[];isParent=!0;isDeprecated=!1;id={};_defaultOpen=!1;parent;constructor(e,t){super(),this.type=e,this.name=t.name,this.description=t.description??"",this.summaryItems=t.summaryItems??[],this.comment=t.comment??"",this.setComponents(t.components||[]),this.data=t.data||[],this.preview=t.preview||[]}getValue(e){const t=this.data?.find(s=>s.key==e);return!t||!t.meetsRequirements(this)?"":t.getSummary()}setComponents=e=>{e.forEach(t=>t.parent=this),this.components.set([...e])};contains=e=>{const t=r(this.components);if(t.includes(e))return!0;for(const s of t)if(s.contains(e))return!0;return!1};addComponent=(e,t=-1)=>{const s=r(this.components);t==-1?s.push(e):s.splice(t,0,e),this.setComponents(s)};removeComponent=e=>{const t=r(this.components);if(t.includes(e)){t.splice(t.indexOf(e),1),e.parent=void 0,this.setComponents(t);return}for(const s of t)s.contains(e)&&s.removeComponent(e)};defaultOpen=()=>(this._defaultOpen=!0,this);toYamlObj(){const e=new l(this.name);if(e.put("type",this.type),e.put("comment",this.comment),this.preview.length>0){const t=new l("preview");t.put("enabled",this.enablePreview),this.preview.filter(s=>s.meetsPreviewRequirements(this)).forEach(s=>{const n=s.getData();Object.keys(n).forEach(a=>t.put(a,n[a]))}),e.put("preview",t)}return e}getRawPreviewData(){const e=new l("preview");return this.preview.forEach(t=>{const s=t.getData();Object.keys(s).forEach(n=>e.put(n,s[n]))}),e}deserialize(e){const t=e.get("preview");t&&(this.enablePreview=t.get("enabled",!1),this.preview.forEach(s=>s.deserialize(t))),this.comment=e.get("comment","").replaceAll("\\n",`
`)}}const te=p({}),se=p({}),ie=p({}),ne=p({}),oe=p(!1),$=p(""),ye=q([te,$],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),Ue=q(ye,i=>{const e={};return i.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),je=q([se,$],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),Qe=q([ie,$],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),Le=q([ne,$],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),Ge=q(Le,i=>{const e={};return i.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e});class C{static getTriggerByName=e=>Object.values(r(te)).find(s=>s.name.toLowerCase()===e.toLowerCase()||s.alias?.toLowerCase()===e.toLowerCase())?.component;static getTargetByName=e=>Object.values(r(se)).find(s=>s.name.toLowerCase()===e.toLowerCase()||s.alias?.toLowerCase()===e.toLowerCase())?.component;static getConditionByName=e=>Object.values(r(ie)).find(s=>s.name.toLowerCase()===e.toLowerCase()||s.alias?.toLowerCase()===e.toLowerCase())?.component;static getMechanicByName=e=>Object.values(r(ne)).find(s=>s.name.toLowerCase()===e.toLowerCase()||s.alias?.toLowerCase()===e.toLowerCase())?.component;static deserializeComponents=e=>{if(!e||!(e instanceof l))return[];const t=[],s=e.getKeys();for(const n of s){let a;const o=e.get(n),c=o.get("type");if(c==="trigger"){const h=C.getTriggerByName(n.split("-")[0]);h&&(a=h.new())}else if(c==="target"){const h=C.getTargetByName(n.split("-")[0]);h&&(a=h.new())}else if(c==="condition"){const h=C.getConditionByName(n.split("-")[0]);h&&(a=h.new())}else if(c==="mechanic"){const h=C.getMechanicByName(n.split("-")[0]);h&&(a=h.new())}a&&(a.deserialize(o),t.push(a))}return t}}class z extends Ce{mana=!1;cooldown=!1;constructor(e,t=!1){super("trigger",e),this.mana=e.mana||!1,this.cooldown=e.cooldown||!1,super.isDeprecated=t}clone=()=>new z({name:this.name,components:[...r(this.components)],mana:this.mana,cooldown:this.cooldown,data:[...this.data],preview:[...this.preview],comment:this.comment,description:this.description,summaryItems:[...this.summaryItems]});toYamlObj(){const e=super.toYamlObj(),t=this.getData();t.getKeys().length>0&&e.put("data",t);const s=r(this.components);return s.length>0&&e.put("children",s),e}getData(){const e=new l("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(e.put("mana",this.mana),e.put("cooldown",this.cooldown)),this.data.filter(t=>t.meetsRequirements(this)).forEach(t=>{const s=t.getData();Object.keys(s).forEach(n=>e.put(n,s[n]))}),e}getRawData(){const e=new l("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(e.put("mana",this.mana),e.put("cooldown",this.cooldown)),this.data.forEach(t=>{const s=t.getData();Object.keys(s).forEach(n=>e.put(n,s[n]))}),e}deserialize(e){super.deserialize(e);const t=e.get("data");t&&(this.mana=t.get("mana",!1),this.cooldown=t.get("cooldown",!1),this.data.forEach(s=>s.deserialize(t))),this.setComponents(e.get("children",[],s=>C.deserializeComponents(s)))}static new=()=>new z({name:"null"})}class b{dataType="skill";location="local";loaded=!1;tooBig=!1;acknowledged=!1;isSkill=!0;key={};name;previousName="";type="Dynamic";maxLevel=5;skillReq;skillReqLevel=0;attributeRequirements=[];permission=!1;levelReq=new f("level",1,0);cost=new f("cost",1,0);cooldown=new f("cooldown",0,0);cooldownMessage=!0;mana=new f("mana",0,0);minSpent=new f("points-spent-req",0,0);castMessage="&6{player} &2has cast &6{skill}";combo="";icon={material:"Pumpkin",customModelData:0,lore:["&d{name} &7({level}/{max})","&2Type: &6{type}","","{req:level}Level: {attr:level}","{req:cost}Cost: {attr:cost}","","&2Mana: {attr:mana}","&2Cooldown: {attr:cooldown}"]};incompatible=[];triggers=[];skillReqStr="";incompStr=[];constructor(e){this.name=e?.name||"Skill",e&&(e.location&&(this.location=e.location),e.type&&(this.type=e.type),e.maxLevel&&(this.maxLevel=e.maxLevel),e.skillReq&&(this.skillReq=e.skillReq),e.skillReqLevel&&(this.skillReqLevel=e.skillReqLevel),e.attributeRequirements&&(this.attributeRequirements=e.attributeRequirements.map(t=>new f(t.name,t.base,t.scale))),e.permission&&(this.permission=e.permission),e.levelReq&&(this.levelReq=e.levelReq),e.cost&&(this.cost=e.cost),e.cooldown&&(this.cooldown=e.cooldown),e.cooldownMessage&&(this.cooldownMessage=e.cooldownMessage),e.mana&&(this.mana=e.mana),e.minSpent&&(this.minSpent=e.minSpent),e.castMessage&&(this.castMessage=e.castMessage),e.combo&&(this.combo=e.combo),e.icon&&(this.icon=e.icon),e.incompatible&&(this.incompatible=e.incompatible),e.triggers&&(this.triggers=e.triggers))}addComponent=e=>{if(e instanceof z){this.triggers=[...this.triggers,e];return}this.triggers.length===0&&this.triggers.push(C.getTriggerByName("cast")?.new()),this.triggers[0].addComponent(e),this.triggers=[...this.triggers]};removeComponent=e=>{if(e instanceof z&&this.triggers.includes(e)){this.triggers.splice(this.triggers.indexOf(e),1);return}for(const t of this.triggers)t.contains(e)&&t.removeComponent(e);this.triggers=[...this.triggers]};serializeYaml=()=>{const e=new l(this.name),t=new l;t.put("name",this.name),t.put("type",this.type),t.put("max-level",this.maxLevel),t.put("skill-req",this.skillReq?.name),t.put("skill-req-lvl",this.skillReqLevel),t.put("needs-permission",this.permission),t.put("cooldown-message",this.cooldownMessage),t.put("msg",this.castMessage),t.put("combo",this.combo),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore);const s=new l("attributes");return s.put("level",this.levelReq),s.put("cost",this.cost),s.put("cooldown",this.cooldown),s.put("mana",this.mana),s.put("points-spent-req",this.minSpent),s.put("incompatible",this.incompatible.map(n=>n.name)),this.attributeRequirements.forEach(n=>s.put(n.name.toLowerCase(),n)),t.put("attributes",s),t.put("components",this.triggers),e.data=t.data,e};load=e=>{this.name=e.get("name",this.name),this.type=e.get("type",this.type),this.maxLevel=e.get("max-level",this.maxLevel),this.skillReqStr=e.get("skill-req",this.skillReqStr),this.skillReqLevel=e.get("skill-req-lvl",this.skillReqLevel),this.permission=e.get("needs-permission",this.permission),this.cooldownMessage=e.get("cooldown-message",this.cooldownMessage),this.castMessage=e.get("msg",this.castMessage),this.combo=e.get("combo",this.combo);const t=e.get("attributes");this.levelReq=new f("level",t.get("level-base"),t.get("level-scale")),this.cost=new f("cost",t.get("cost-base"),t.get("cost-scale")),this.cooldown=new f("cooldown",t.get("cooldown-base"),t.get("cooldown-scale")),this.mana=new f("mana",t.get("mana-base"),t.get("mana-scale")),this.minSpent=new f("points-spent-req",t.get("points-spent-req-base"),t.get("points-spent-req-scale")),this.incompStr=t.get("incompatible",this.incompStr);const s=["level","cost","cooldown","mana","points-spent-req","incompatible"],n=new Set(t.getKeys().map(o=>o.replace(/-(base|scale)/i,"")).filter(o=>!s.includes(o)));this.attributeRequirements=[...n].map(o=>new f(o,t.get(o+"-base"),t.get(o+"-scale"))),this.icon.material=e.get("icon",this.icon.material,ee),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore);let a;a=oe.subscribe(o=>{o&&(this.triggers=e.get("components",this.triggers,c=>C.deserializeComponents(c)),a&&a())}),this.loaded=!0};postLoad=()=>{this.skillReq=L(this.skillReqStr),this.incompatible=this.incompStr.map(e=>L(e)).filter(e=>!!e)};save=()=>{if(!this.name||this.tooBig)return;if(this.tooBig&&!this.acknowledged){Z.set(this);return}D.set(!0);const e=this.serializeYaml();if(this.location!=="server"){this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.skill."+this.previousName),this.previousName=this.name;try{localStorage.setItem("sapi.skill."+this.name,e.toString()),this.tooBig=!1}catch(t){t?.message?.includes("quota")?(localStorage.removeItem("sapi.skill."+this.name),this.tooBig=!0,Z.set(this)):console.error(this.name+" Save error",t)}D.set(!1)}}}const x=ve("goto");let ae=!1;const qe=i=>{const e=[],t=I(i);let s;if(t.key&&!t.data[t.key]){const n=t.key;return n==="loaded"||(s=new b({name:n}),s.load(t),e.push(s)),e}for(const n in t.data)n!="loaded"&&t.data[n]instanceof l&&(s=new b({name:n}),s.load(t.data[n]),e.push(s));return e},re=(i,e,t,s,n)=>{let a=e;{const m=localStorage.getItem(i);m&&(a=t(m),n&&n(a))}const{subscribe:o,set:c,update:h}=p(a);return{subscribe:o,set:m=>(s&&(m=s(m)),c(m)),update:h}},d=re(localStorage.getItem("skillNames")?"skillNames":"skillData",[],i=>localStorage.getItem("skillNames")?i.split(", ").map(e=>new b({name:e,location:"local"})).filter(e=>localStorage.getItem("sapi.skill."+e.name)):(localStorage.removeItem("skillData"),ae=!0,w(qe(i))),i=>(he(),w(i))),L=i=>{for(const e of r(d))if(e.name==i)return e},k=re("skillFolders",[],i=>!i||i==="null"?[]:JSON.parse(i,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return L(s);const n=new u(s.data);return n.name=s.name,n}return s}}),i=>{const e=JSON.stringify(i,(t,s)=>s instanceof b||s instanceof b?s.name:t==="parent"?void 0:s);return localStorage.setItem("skillFolders",e),w(i)}),W=i=>!!L(i),V=i=>{const e=r(d);let t=e.length+1;for(;!i&&W(i||"Skill "+t);)t++;const s=new b({name:i||"Skill "+t});return e.push(s),d.set(e),s.save(),s},le=i=>{i.loaded||(i.location==="local"&&i.load(I(localStorage.getItem(`sapi.skill.${i.name}`)||"")),i.postLoad())},Ke=i=>{i.loaded||le(i);const e=r(d);let t=i.name+" (Copy)",s=1;for(;W(t);)t=i.name+" (Copy "+s+")",s++;const n=new b;return n.load(I(i.serializeYaml().toString())),n.name=t,e.push(n),d.set(e),n.save(),n},Ve=i=>{const e=r(k);e.includes(i)||(P(i,e),e.push(i),e.sort((t,s)=>t.name.localeCompare(s.name)),k.set(e))},ce=(i,e)=>{const t=r(k).filter(s=>s!=i);i.data.forEach(s=>{if(s instanceof u){if(e&&e(s)){ce(s,e);return}i.parent?i.parent.add(s):(s.updateParent(),t.push(s))}else i.parent&&i.parent.add(s)}),k.set(t)},Oe=i=>{const e=r(d).filter(s=>s!=i),t=r(O);d.set(e),localStorage.removeItem("sapi.skill."+i.name),t instanceof b&&(e.length===0?x(`${A}/`):e.find(s=>s===r(O))||x(`${A}/skill/${e[0].name}`))},M=()=>d.set(w(r(d))),Ne=()=>{k.set(w(r(k))),M()},Q=async(i,e=!1)=>{const t=I(i);console.log(t);let s;if(t.key&&!t.data[t.key]){const n=t.key;s=W(n)?L(n):V(n),e&&(s.location="server"),s.load(t),s.save(),M();return}for(const n in t.data)n!="loaded"&&t.data[n]instanceof l&&!W(n)&&(s=W(n)?L(n):V(n),s.load(t.data[n]),s.save());M()},Re=async i=>{const e=i.target?.result;e&&await Q(e)},D=p(!1);let U;const he=i=>{r(D)&&U&&clearTimeout(U),D.set(!0),U=setTimeout(()=>{const e=(i||r(d)).filter(t=>t.location==="local");localStorage.setItem("skillNames",e.map(t=>t.name).join(", ")),D.set(!1)})};r(d).forEach(i=>{i.loaded&&i.postLoad()});if(ae){const i=oe.subscribe(e=>{e&&(r(d).forEach(t=>{t.location==="local"&&t.save()}),he(),i&&i())})}class v{dataType="class";location="local";loaded=!1;isClass=!0;key={};name;previousName="";prefix="";group="class";manaName="&2Mana";maxLevel=40;parentStr="";_parent;get parent(){return this._parent}set parent(e){this._parent=e,this.parentStr=e?e.name:""}permission=!1;expSources=273;manaRegen=1;health=new f("health",20,1);mana=new f("mana",20,1);attributes=[];skillTree="Requirement";skills=[];icon={material:"Pumpkin",customModelData:0};unusableItems=[];actionBar="";lInverted=!1;rInverted=!1;lsInverted=!1;rsInverted=!1;pInverted=!1;qInverted=!1;fInverted=!1;lWhitelist=[];rWhitelist=[];lsWhitelist=[];rsWhitelist=[];pWhitelist=[];qWhitelist=[];fWhitelist=[];constructor(e){this.name=e?e.name:"Class",this.prefix=e?.prefix?e.prefix:"&6"+this.name,e&&(e?.location&&(this.location=e.location),e?.group&&(this.group=e.group),e?.manaName&&(this.manaName=e.manaName),e?.maxLevel&&(this.maxLevel=e.maxLevel),e?.parent&&(this.parent=e.parent),e?.permission&&(this.permission=e.permission),e?.expSources&&(this.expSources=e.expSources),e?.health&&(this.health=e.health),e?.mana&&(this.mana=e.mana),e?.manaRegen&&(this.manaRegen=e.manaRegen),e?.attributes&&(this.attributes=e.attributes),e?.skillTree&&(this.skillTree=e.skillTree),e?.skills&&(this.skills=e.skills),e?.icon&&(this.icon=e.icon),e?.unusableItems&&(this.unusableItems=e.unusableItems),e?.actionBar&&(this.actionBar=e.actionBar),e?.lInverted&&(this.lInverted=e.lInverted),e?.rInverted&&(this.rInverted=e.rInverted),e?.lsInverted&&(this.lsInverted=e.lsInverted),e?.rsInverted&&(this.rsInverted=e.rsInverted),e?.pInverted&&(this.pInverted=e.pInverted),e?.qInverted&&(this.qInverted=e.qInverted),e?.fInverted&&(this.fInverted=e.fInverted),e?.lWhitelist&&(this.lWhitelist=e.lWhitelist),e?.rWhitelist&&(this.rWhitelist=e.rWhitelist),e?.lsWhitelist&&(this.lsWhitelist=e.lsWhitelist),e?.rsWhitelist&&(this.rsWhitelist=e.rsWhitelist),e?.pWhitelist&&(this.pWhitelist=e.pWhitelist),e?.qWhitelist&&(this.qWhitelist=e.qWhitelist),e?.fWhitelist&&(this.fWhitelist=e.fWhitelist))}updateAttributes=e=>{const t=[];this.attributes=this.attributes.filter(s=>e?.includes(s.name)?(t.push(s.name),!0):!1),e=e.filter(s=>!t.includes(s));for(const s of e)this.attributes.push(new f(s,0,0))};serializeYaml=()=>{const e=new l(this.name),t=new l;t.put("name",this.name),t.put("action-bar",this.actionBar),t.put("prefix",this.prefix),t.put("group",this.group),t.put("mana",this.manaName),t.put("max-level",this.maxLevel),t.put("parent",this.parent?.name||""),t.put("needs-permission",this.permission),t.put("attributes",[this.health,this.mana,...this.attributes]),t.put("mana-regen",this.manaRegen),t.put("skill-tree",this.skillTree.toUpperCase().replace(/ /g,"_")),t.put("blacklist",this.unusableItems),t.put("skills",this.skills.map(N=>N.name)),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore),t.put("exp-source",this.expSources);const s=new l("combo-starters"),n=new l("L");n.put("inverted",this.lInverted),n.put("whitelist",this.lWhitelist),s.put("L",n);const a=new l("R");a.put("inverted",this.rInverted),a.put("whitelist",this.rWhitelist),s.put("R",a);const o=new l("LS");o.put("inverted",this.lsInverted),o.put("whitelist",this.lsWhitelist),s.put("LS",o);const c=new l("RS");c.put("inverted",this.rsInverted),c.put("whitelist",this.rsWhitelist),s.put("RS",c);const h=new l("P");h.put("inverted",this.pInverted),h.put("whitelist",this.pWhitelist),s.put("P",h);const m=new l("Q");m.put("inverted",this.qInverted),m.put("whitelist",this.qWhitelist),s.put("Q",m);const y=new l("F");return y.put("inverted",this.fInverted),y.put("whitelist",this.fWhitelist),s.put("F",y),t.put("combo-starters",s),e.data=t.data,e};updateParent=e=>{this.parentStr&&(this.parent=e.find(t=>t.name===this.parentStr))};load=e=>{this.name=e.get("name",this.name),this.actionBar=e.get("action-bar",this.actionBar),this.manaName=e.get("mana",this.manaName),this.prefix=e.get("prefix",this.prefix),this.group=e.get("group",this.group),this.maxLevel=e.get("max-level",this.maxLevel),this.parentStr=e.get("parent",this.parentStr),this.permission=e.get("needs-permission",this.permission),this.attributes=e.get("attributes",this.attributes,s=>{const n=[],a=s.get("health-base",20),o=s.get("health-scale",1),c=s.get("mana-base",20),h=s.get("mana-scale",1);this.health=new f("health",a,o),this.mana=new f("mana",c,h),s.remove("health-base"),s.remove("health-scale"),s.remove("mana-base"),s.remove("mana-scale");const m={};return Object.keys(s.data).forEach(y=>{const N=y.split("-"),F=N[0];m[F]||(m[F]=new f(F,0,0));const K=m[F];N[1]=="base"&&(K.base=Number.parseFloat(s.data[y])),N[1]=="scale"&&(K.scale=Number.parseFloat(s.data[y]))}),n.push(...Object.values(m)),n}),this.manaRegen=e.get("mana-regen",this.manaRegen),this.skillTree=e.get("skill-tree",this.skillTree,ke),this.unusableItems=e.get("blacklist",this.unusableItems),this.skills=e.get("skills",this.skills,s=>s.map(n=>L(n)).filter(n=>!!n)),this.icon.material=e.get("icon",this.icon.material,ee),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore),this.expSources=e.get("exp-source",this.expSources);const t=e.get("combo-starters",new l);this.lInverted=t.get("L",new l).get("inverted",this.lInverted),this.rInverted=t.get("R",new l).get("inverted",this.rInverted),this.lsInverted=t.get("LS",new l).get("inverted",this.lsInverted),this.rsInverted=t.get("RS",new l).get("inverted",this.rsInverted),this.pInverted=t.get("P",new l).get("inverted",this.pInverted),this.qInverted=t.get("Q",new l).get("inverted",this.qInverted),this.fInverted=t.get("F",new l).get("inverted",this.fInverted),this.lWhitelist=t.get("L",new l).get("whitelist",this.lWhitelist),this.rWhitelist=t.get("R",new l).get("whitelist",this.rWhitelist),this.lsWhitelist=t.get("LS",new l).get("whitelist",this.lsWhitelist),this.rsWhitelist=t.get("RS",new l).get("whitelist",this.rsWhitelist),this.pWhitelist=t.get("P",new l).get("whitelist",this.pWhitelist),this.qWhitelist=t.get("Q",new l).get("whitelist",this.qWhitelist),this.fWhitelist=t.get("F",new l).get("whitelist",this.fWhitelist),this.loaded=!0};save=()=>{if(!this.name||this.location==="server")return;const e=this.serializeYaml();this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.class."+this.previousName),this.previousName=this.name,localStorage.setItem("sapi.class."+this.name,e.toString())}}let me=!1;const We=i=>{const e=[],t=I(i);let s;if(t.key&&!t.data[t.key]){const n=t.key;return n==="loaded"||(s=new v({name:n}),s.load(t),e.push(s)),e}for(const n in t.data)n!="loaded"&&t.data[n]instanceof l&&(s=new v({name:n}),s.load(t.data[n]),e.push(s));return e},pe=(i,e,t,s,n)=>{let a=e;{const m=localStorage.getItem(i);m&&(a=t(m),n&&n(a))}const{subscribe:o,set:c,update:h}=p(a);return{subscribe:o,set:m=>(s&&(m=s(m)),c(m)),update:h}},g=pe(localStorage.getItem("classNames")?"classNames":"classData",[],i=>localStorage.getItem("classNames")?i.split(", ").map(e=>new v({name:e,location:"local"})).filter(e=>localStorage.getItem("sapi.class."+e.name)):(localStorage.removeItem("classData"),me=!0,w(We(i))),i=>(ge(i),i.forEach(e=>e.updateParent(i)),w(i)),i=>i.forEach(e=>e.updateParent(i))),B=i=>{for(const e of r(g))if(e.name==i)return e},S=pe("classFolders",[],i=>!i||i==="null"?[]:JSON.parse(i,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return B(s);const n=new u(s.data);return n.name=s.name,n}return s}}),i=>{const e=JSON.stringify(i,(t,s)=>s instanceof v||s instanceof b?s.name:t==="parent"?void 0:s);return localStorage.setItem("classFolders",e),w(i)}),H=i=>r(g).forEach(e=>e.updateAttributes(i)),T=i=>!!B(i),X=i=>{const e=r(g);let t=e.length+1;for(;!i&&T(i||"Class "+t);)t++;const s=new v({name:i||"Class "+t});return e.push(s),g.set(e),s.save(),s},fe=i=>{i.loaded||(i.location==="local"&&i.load(I(localStorage.getItem(`sapi.class.${i.name}`)||"")),i.updateParent(r(g)),i.loaded=!0)},He=i=>{i.loaded||fe(i);const e=r(g);let t=i.name+" (Copy)",s=1;for(;T(t);)t=i.name+" (Copy "+s+")",s++;const n=new v;return n.load(I(i.serializeYaml().toString())),n.name=t,e.push(n),g.set(e),n.save(),n},Xe=i=>{const e=r(S);e.includes(i)||(P(i,e),e.push(i),e.sort((t,s)=>t.name.localeCompare(s.name)),S.set(e))},ue=(i,e)=>{const t=r(S).filter(s=>s!=i);i.data.forEach(s=>{if(s instanceof u){if(e&&e(s)){ue(s,e);return}i.parent?i.parent.add(s):(s.updateParent(),t.push(s))}else i.parent&&i.parent.add(s)}),S.set(t)},De=i=>{const e=r(g).filter(s=>s!=i),t=r(O);g.set(e),localStorage.removeItem("sapi.class."+i.name),t instanceof v&&(e.length===0?x(`${A}/`):e.find(s=>s===r(O))||x(`${A}/class/${e[0].name}/edit`))},Y=()=>g.set(w(r(g))),Te=()=>{S.set(w(r(S))),Y()},G=(i,e=!1)=>{const t=I(i);let s;if(t.key&&!t.data[t.key]){const n=t.key;s=T(n)?B(n):X(n),e&&(s.location="server"),s.load(t),Y();return}for(const n in t.data)n!="loaded"&&t.data[n]instanceof l&&!T(n)&&(s=T(n)?B(n):X(n),s.load(t.data[n]));Y()},ze=i=>{const e=i.target?.result;e&&G(e)},ge=i=>{const e=(i||r(g)).filter(t=>t.location==="local");localStorage.setItem("classNames",e.map(t=>t.name).join(", "))};me&&(r(g).forEach(i=>{i.location==="local"&&i.save()}),ge());const Ee=(()=>{let i=["vitality","spirit","intelligence","dexterity","strength"];{const n=localStorage.getItem("attribs");n&&(i=n.split(","),H(i))}const{subscribe:e,set:t,update:s}=p(i);return{subscribe:e,set:n=>(localStorage.setItem("attribs",n.join(",")),H(n),t(n)),update:s}})(),de=i=>{const e=I(i),t=Object.keys(e.data);Ee.set(t)},O=p(void 0),Fe=q(O,i=>i instanceof v?"class":"skill"),Ze=p(),_e=p(),E=Se("sidebarOpen",!0),et=p(!0),we=p(!0),Ae=p(!1),tt=()=>{r(E)&&(r(Fe)=="class"?Y():M(),J())},st=()=>E.set(!r(E)),it=()=>E.set(!1),nt=i=>Ae.set(i),P=(i,e)=>{const t=i.name;let s=1;for(;e.filter(n=>n instanceof u&&n.name==i.name).length>=1;)i.name=t+" ("+s+++")"},ot=i=>{i.parent?(i.parent.deleteFolder(i),J()):r(we)?ue(i,()=>!1):ce(i,()=>!1)},at=i=>{i&&(Me(i)?.remove(i),i instanceof v?De(i):Oe(i),J())},J=()=>{r(E)&&(r(we)?Te():Ne())},xe=i=>{const e=r(S),t=r(k);e.includes(i)&&S.set(e.filter(s=>s!=i)),t.includes(i)&&k.set(t.filter(s=>s!=i))},Me=i=>{if(!i)return;if(i instanceof u)return i.parent;const e=i instanceof v?r(S):r(k);for(const t of e){const s=t.getContainingFolder(i);if(s)return s}},Be=async i=>{const e=i.target?.result;e&&(e.indexOf("global:")>=0?de(e):e.indexOf("components:")>=0||e.indexOf("group:")==-1&&e.indexOf("combo:")==-1&&e.indexOf("skills:")==-1?await Q(e):G(e),document.activeElement.blur())},rt=(i,e=!1)=>{i&&(i.indexOf("global:")>=0?de(i):i.indexOf("components:")>=0||i.indexOf("group:")==-1&&i.indexOf("combo:")==-1&&i.indexOf("skills:")==-1?(console.log("loading skills"),Q(i.replace(`loaded: false
`,""),e)):(console.log("loading classes"),G(i.replace(`loaded: false
`,""),e)))},lt=i=>{const e=new FileReader;i.name.indexOf("skills")==0?e.onload=Re:i.name.indexOf("classes")==0?e.onload=ze:e.onload=Be,e.readAsText(i)},ct=i=>{const e=i||r(O);e&&j(e.name+".yml",e.serializeYaml().toString())},Ye=()=>{const i=r(d);i.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new l;e.put("loaded",!1);for(const t of i)t.loaded||le(t),e.put(t.name,t.serializeYaml());return e},Pe=()=>{const i=r(g);i.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new l;e.put("loaded",!1);for(const t of i)t.loaded||fe(t),e.put(t.name,t.serializeYaml());return e},ht=async()=>{const i=Ye(),e=Pe();j("skills.yml",i.toString()),j("classes.yml",e.toString())},j=(i,e)=>{const t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=i,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)},Z=p();export{Ue as $,Ve as A,He as B,Ke as C,ct as D,at as E,ot as F,xe as G,S as H,k as I,X as J,V as K,it as L,D as M,ht as N,E as O,f as P,Ae as Q,Z as R,I as S,$ as T,je as U,Qe as V,Le as W,Ge as X,_e as Y,C as Z,l as _,lt as a,Ce as a0,Ee as a1,tt as a2,ke as a3,Se as a4,Fe as b,O as c,g as d,v as e,B as f,x as g,d as h,b as i,L as j,te as k,rt as l,se as m,ie as n,ne as o,oe as p,z as q,Me as r,nt as s,st as t,et as u,Ze as v,J as w,u as x,we as y,Xe as z};
