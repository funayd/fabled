import{w as u,k as O,l as ce,e as F}from"./singletons.xBDtRdjO.js";import{A as r}from"./scheduler.094yGyYV.js";const X={INT:/^-?[0-9]+$/,FLOAT:/^-?[0-9]+\.[0-9]+$/,SPACE:/^( +)/},L=n=>{n=n.replace(/\r\n/g,`
`).replace(/\n *\n/g,`
`).replace(/ +\n/g,`
`);const e=new h,t=0,s=n.split(`
`);return e.parse(s,t,0),e},D=n=>{const e=n.match(X.SPACE);return e?e[1].length:0};class he{data;constructor(e){this.data=e}set=e=>this.data=e;get=()=>this.data}class h{key;data={};constructor(e){this.key=e}put=(e,t)=>{this.data[e]=t};has=e=>this.data[e]!==void 0;get=(e,t,s)=>((this.data[e]=="[]"||this.data[e]==" []")&&(this.data[e]=JSON.parse(this.data[e].trim())),this.has(e)?s?s(this.data[e]):this.data[e]:t);getKeys=()=>Object.keys(this.data);remove=e=>{delete this.data[e]};parse=(e,t,s,i)=>{for(i&&(this.key=i);t<e.length&&D(e[t])>=s;){for(;t<e.length&&(D(e[t])!=s||e[t].replace(/ /g,"").charAt(0)=="#"||e[t].indexOf(":")==-1);)t++;if(t==e.length)return t;let o=e[t].substring(s,e[t].indexOf(":"));if(o==="loaded"){t++;continue}if(o.match(/^["'].*["']$/)&&(o=o.substring(1,o.length-1)),!this.key&&!i&&(this.key=o),e[t].search(/: +\{\}/)!=-1&&e[t].length>=4)this.data[o]=new h(o);else if(t<e.length-1&&e[t+1].charAt(s)=="-"&&e[t+1].charAt(s+1)==" "&&D(e[t+1])==s){const a=[];for(;++t<e.length&&e[t].charAt(s)=="-";){let l=e[t].substring(s+2);(l.charAt(0)=="'"||l.charAt(0)=='"')&&(l=l.substring(1,l.length-1).replace(/\\(['"])/,c=>c.replace("\\",""))),a.push(l)}this.data[o]=a,t--}else if(t<e.length-1&&D(e[t+1])>s){t++;const a=D(e[t]),l=new h;t=l.parse(e,t,a,o)-1,this.data[o]=l}else{let a=e[t].substring(e[t].indexOf(":")+2);a.charAt(0)=="'"||a.charAt(0)=='"'?a=a.substring(1,a.length-1):isNaN(a)||(X.INT.test(a)?a=parseInt(a):a=parseFloat(a)),typeof a=="string"&&(a.toLowerCase()=="false"?a=!1:a.toLowerCase()=="true"?a=!0:a=a.replace(/\\(['"])/,l=>l.replace("\\",""))),this.data[o]=a}do t++;while(t<e.length&&e[t].replace(/ /g,"").charAt(0)=="#")}return Object.keys(this.data).length==1&&this.key&&this.data[this.key]instanceof h&&(this.data=this.data[this.key].data),t};toString=()=>this.toYaml(this.key||this.data.name?"'"+(this.key||this.data.name)+"'":void 0,this.data);toYaml=(e,t,s=new he("a"),i="")=>{if(t instanceof h)return t.toYaml("'"+(e??t.key)+"'",t.data,s,i);let o="";e&&(o+=i+e+`:
`,i+="  ");for(const a of Object.keys(t)){const l=t[a];let c="";if(l!=null){if(l instanceof Object)if(Object.keys(l).includes("toYaml"))if(l instanceof h){o+=l.toYaml("'"+a+"'",l.data,s,i);continue}else c=l.toYaml(i);else l instanceof Array&&(c=this.convertArray(a,s,i,l));else{const m=JSON.stringify(l);c=i+a+": "+m+`
`}c&&(o+=c.replaceAll(/(\\)?'/g,"\\'").replaceAll(/((\\)?")/g,m=>m.length==1?"'":m).replaceAll(/\\"/g,'"').replace(/\\\\/g,"\\"))}}return o};nextChar=e=>/z+/.test(e)?e.replaceAll(/z/g,"a")+"a":e.substring(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1);convertArray(e,t,s,i){if(e!="attributes"){let o=s+e+":";if(["string","number"].includes(typeof i[0]))i.length>0?(o+=`
`,i.forEach(a=>o+=s+"- "+JSON.stringify(a)+`
`)):o+=` []
`;else if(e==="components"||e==="children")if(i.length==0)o+=` {}
`;else return o+=`
`,i.forEach(a=>{const l=t.get();t.set(this.nextChar(t.get())),o+=this.toYaml(a.name+"-"+l,a.toYamlObj(),t,s+"  ")}),o.replaceAll(/'/g,'"');else o+=` []
`;return o}else return this.toYaml(e,i,t,s)}}class p{name;base;scale;constructor(e,t,s){this.name=e,this.base=t,this.scale=s}toYaml=(e="")=>e+this.name.toLowerCase()+"-base: "+this.base+`
`+e+this.name.toLowerCase()+"-scale: "+this.scale+`
`}class f{key={};isFolder=!0;open=!1;name="Folder";data=[];parent;constructor(e){e&&(this.data=e,e.forEach(t=>{t instanceof f&&t.isFolder&&t.updateParent(this)}))}updateParent=e=>{this.parent=e};add=e=>{this.data.includes(e)||(e instanceof f&&(x(e,this.data),ze(e),e.parent=this),this.data.push(e),this.sort())};remove=e=>{this.data=this.data.filter(t=>t!=e),this.sort()};sort=()=>{this.data=this.data.sort((e,t)=>{let s=0;return e instanceof f&&(t instanceof f||(s=-100)),e.name.localeCompare(t.name)+s}),P()};createFolder=()=>{const e=new f;x(e,this.data),this.data.push(e),this.sort(),e.updateParent(this)};deleteFolder=e=>{this.data=this.data.filter(t=>t!=e)};contains=e=>{if(this.data.includes(e))return!0;for(const t of this.data.filter(s=>s instanceof f))if(t.contains(e))return!0;return!1};getContainingFolder=e=>{if(this.data.includes(e))return this;for(const t of this.data.filter(s=>s instanceof f)){if(t.data.includes(e))return t;{const s=t.getContainingFolder(e);if(!s)continue;return s}}}}const me=n=>n.replace("_"," ").toLowerCase().replace(/^(.)|\s(.)/g,e=>e.toUpperCase()),Z=n=>(n=n.replace("_"," "),n.substring(0,1).toUpperCase()+n.substring(1).toLowerCase()),w=n=>n.sort((e,t)=>e.name.localeCompare(t.name)),pe=(n,e)=>{let t=e;localStorage.getItem(n)===null&&(typeof e=="string"||typeof e=="number"||typeof e=="boolean"?localStorage.setItem(n,e.toString()):localStorage.setItem(n,JSON.stringify(e))),typeof e=="number"?t=parseInt(localStorage.getItem(n)):typeof e=="boolean"?t=localStorage.getItem(n)==="true":typeof e=="string"?t=localStorage.getItem(n):t=JSON.parse(localStorage.getItem(n));const{subscribe:s,set:i,update:o}=u(t);return{subscribe:s,set:a=>(typeof a=="string"||typeof a=="number"||typeof a=="boolean"?localStorage.setItem(n,a.toString()):localStorage.setItem(n,JSON.stringify(a)),i(a)),update:o}};class ue{static new=()=>{throw new Error("'new' method not implemented")}}class fe extends ue{type;name;description;comment;components=u([]);data=[];preview=[];enablePreview=!1;summaryItems=[];isParent=!0;isDeprecated=!1;id={};_defaultOpen=!1;parent;constructor(e,t){super(),this.type=e,this.name=t.name,this.description=t.description??"",this.summaryItems=t.summaryItems??[],this.comment=t.comment??"",this.setComponents(t.components||[]),this.data=t.data||[],this.preview=t.preview||[]}getValue(e){const t=this.data?.find(s=>s.key==e);return!t||!t.meetsRequirements(this)?"":t.getSummary()}setComponents=e=>{e.forEach(t=>t.parent=this),this.components.set([...e])};contains=e=>{const t=r(this.components);if(t.includes(e))return!0;for(const s of t)if(s.contains(e))return!0;return!1};addComponent=(e,t=-1)=>{const s=r(this.components);t==-1?s.push(e):s.splice(t,0,e),this.setComponents(s)};removeComponent=e=>{const t=r(this.components);if(t.includes(e)){t.splice(t.indexOf(e),1),e.parent=void 0,this.setComponents(t);return}for(const s of t)s.contains(e)&&s.removeComponent(e)};defaultOpen=()=>(this._defaultOpen=!0,this);toYamlObj(){const e=new h(this.name);if(e.put("type",this.type),e.put("comment",this.comment),this.preview.length>0){const t=new h("preview");t.put("enabled",this.enablePreview),this.preview.filter(s=>s.meetsPreviewRequirements(this)).forEach(s=>{const i=s.getData();Object.keys(i).forEach(o=>t.put(o,i[o]))}),e.put("preview",t)}return e}getRawPreviewData(){const e=new h("preview");return this.preview.forEach(t=>{const s=t.getData();Object.keys(s).forEach(i=>e.put(i,s[i]))}),e}deserialize(e){const t=e.get("preview");t&&(this.enablePreview=t.get("enabled",!1),this.preview.forEach(s=>s.deserialize(t))),this.comment=e.get("comment","").replaceAll("\\n",`
`)}}const _=u({}),ee=u({}),te=u({}),se=u({}),ge=u(!1),B=u(""),de=O([_,B],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),xe=O(de,n=>{const e={};return n.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),Be=O([ee,B],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),Pe=O([te,B],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),we=O([se,B],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),Je=O(we,n=>{const e={};return n.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e});class v{static getTriggerByName=e=>Object.values(r(_)).find(s=>s.name.toLowerCase()===e.toLowerCase())?.component;static getTargetByName=e=>Object.values(r(ee)).find(s=>s.name.toLowerCase()===e.toLowerCase())?.component;static getConditionByName=e=>Object.values(r(te)).find(s=>s.name.toLowerCase()===e.toLowerCase())?.component;static getMechanicByName=e=>Object.values(r(se)).find(s=>s.name.toLowerCase()===e.toLowerCase())?.component;static deserializeComponents=e=>{if(!e||!(e instanceof h))return[];const t=[],s=e.getKeys();for(const i of s){let o;const a=e.get(i),l=a.get("type");if(l==="trigger"){const c=v.getTriggerByName(i.split("-")[0]);c&&(o=c.new())}else if(l==="target"){const c=v.getTargetByName(i.split("-")[0]);c&&(o=c.new())}else if(l==="condition"){const c=v.getConditionByName(i.split("-")[0]);c&&(o=c.new())}else if(l==="mechanic"){const c=v.getMechanicByName(i.split("-")[0]);c&&(o=c.new())}o&&(o.deserialize(a),t.push(o))}return t}}class R extends fe{mana=!1;cooldown=!1;constructor(e,t=!1){super("trigger",e),this.mana=e.mana||!1,this.cooldown=e.cooldown||!1,super.isDeprecated=t}clone=()=>new R({name:this.name,components:[...r(this.components)],mana:this.mana,cooldown:this.cooldown,data:[...this.data],preview:[...this.preview],comment:this.comment,description:this.description,summaryItems:[...this.summaryItems]});toYamlObj(){const e=super.toYamlObj(),t=this.getData();t.getKeys().length>0&&e.put("data",t);const s=r(this.components);return s.length>0&&e.put("children",s),e}getData(){const e=new h("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(e.put("mana",this.mana),e.put("cooldown",this.cooldown)),this.data.filter(t=>t.meetsRequirements(this)).forEach(t=>{const s=t.getData();Object.keys(s).forEach(i=>e.put(i,s[i]))}),e}getRawData(){const e=new h("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(e.put("mana",this.mana),e.put("cooldown",this.cooldown)),this.data.forEach(t=>{const s=t.getData();Object.keys(s).forEach(i=>e.put(i,s[i]))}),e}deserialize(e){super.deserialize(e);const t=e.get("data");t&&(this.mana=t.get("mana",!1),this.cooldown=t.get("cooldown",!1),this.data.forEach(s=>s.deserialize(t))),this.setComponents(e.get("children",[],s=>v.deserializeComponents(s)))}static new=()=>new R({name:"null"})}class b{isSkill=!0;key={};name;type="Dynamic";maxLevel=5;skillReq;skillReqLevel=0;attributeRequirements=[];permission=!1;levelReq=new p("level",1,0);cost=new p("cost",1,0);cooldown=new p("cooldown",0,0);cooldownMessage=!0;mana=new p("mana",0,0);minSpent=new p("points-spent-req",0,0);castMessage="&6{player} &2has cast &6{skill}";combo="";icon={material:"Pumpkin",customModelData:0,lore:["&d{name} &7({level}/{max})","&2Type: &6{type}","","{req:level}Level: {attr:level}","{req:cost}Cost: {attr:cost}","","&2Mana: {attr:mana}","&2Cooldown: {attr:cooldown}"]};incompatible=[];triggers=[];skillReqStr="";incompStr=[];constructor(e){this.name=e?.name||"Skill",e&&(e.type&&(this.type=e.type),e.maxLevel&&(this.maxLevel=e.maxLevel),e.skillReq&&(this.skillReq=e.skillReq),e.skillReqLevel&&(this.skillReqLevel=e.skillReqLevel),e.attributeRequirements&&(this.attributeRequirements=e.attributeRequirements.map(t=>new p(t.name,t.base,t.scale))),e.permission&&(this.permission=e.permission),e.levelReq&&(this.levelReq=e.levelReq),e.cost&&(this.cost=e.cost),e.cooldown&&(this.cooldown=e.cooldown),e.cooldownMessage&&(this.cooldownMessage=e.cooldownMessage),e.mana&&(this.mana=e.mana),e.minSpent&&(this.minSpent=e.minSpent),e.castMessage&&(this.castMessage=e.castMessage),e.combo&&(this.combo=e.combo),e.icon&&(this.icon=e.icon),e.incompatible&&(this.incompatible=e.incompatible),e.triggers&&(this.triggers=e.triggers))}addComponent=e=>{if(e instanceof R){this.triggers=[...this.triggers,e];return}this.triggers.length===0&&this.triggers.push(v.getTriggerByName("cast")?.new()),this.triggers[0].addComponent(e),this.triggers=[...this.triggers]};removeComponent=e=>{if(e instanceof R&&this.triggers.includes(e)){this.triggers.splice(this.triggers.indexOf(e),1);return}for(const t of this.triggers)t.contains(e)&&t.removeComponent(e);this.triggers=[...this.triggers]};serializeYaml=()=>{const e=new h(this.name),t=new h;t.put("name",this.name),t.put("type",this.type),t.put("max-level",this.maxLevel),t.put("skill-req",this.skillReq?.name),t.put("skill-req-lvl",this.skillReqLevel),t.put("needs-permission",this.permission),t.put("cooldown-message",this.cooldownMessage),t.put("msg",this.castMessage),t.put("combo",this.combo),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore);const s=new h("attributes");return s.put("level",this.levelReq),s.put("cost",this.cost),s.put("cooldown",this.cooldown),s.put("mana",this.mana),s.put("points-spent-req",this.minSpent),s.put("incompatible",this.incompatible.map(i=>i.name)),this.attributeRequirements.forEach(i=>s.put(i.name.toLowerCase(),i)),t.put("attributes",s),t.put("components",this.triggers),e.data=t.data,e};load=e=>{this.name=e.get("name",this.name),this.type=e.get("type",this.type),this.maxLevel=e.get("max-level",this.maxLevel),this.skillReqStr=e.get("skill-req",this.skillReqStr),this.skillReqLevel=e.get("skill-req-lvl",this.skillReqLevel),this.permission=e.get("needs-permission",this.permission),this.cooldownMessage=e.get("cooldown-message",this.cooldownMessage),this.castMessage=e.get("msg",this.castMessage),this.combo=e.get("combo",this.combo);const t=e.get("attributes");this.levelReq=new p("level",t.get("level-base"),t.get("level-scale")),this.cost=new p("cost",t.get("cost-base"),t.get("cost-scale")),this.cooldown=new p("cooldown",t.get("cooldown-base"),t.get("cooldown-scale")),this.mana=new p("mana",t.get("mana-base"),t.get("mana-scale")),this.minSpent=new p("points-spent-req",t.get("points-spent-req-base"),t.get("points-spent-req-scale")),this.incompStr=t.get("incompatible",this.incompStr);const s=["level","cost","cooldown","mana","points-spent-req","incompatible"],i=new Set(t.getKeys().map(a=>a.replace(/-(base|scale)/i,"")).filter(a=>!s.includes(a)));this.attributeRequirements=[...i].map(a=>new p(a,t.get(a+"-base"),t.get(a+"-scale"))),this.icon.material=e.get("icon",this.icon.material,Z),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore);let o;o=ge.subscribe(a=>{a&&(this.triggers=e.get("components",this.triggers,l=>v.deserializeComponents(l)),o&&o())})};postLoad=()=>{this.skillReq=y(this.skillReqStr),this.incompatible=this.incompStr.map(e=>y(e)).filter(e=>!!e)}}const T=ce("goto"),be=n=>{const e=[],t=L(n);let s;if(t.key&&!t.data[t.key]){const i=t.key;return i==="loaded"||(s=new b({name:i}),s.load(t),e.push(s)),e}for(const i in t.data)i!="loaded"&&t.data[i]instanceof h&&(s=new b({name:i}),s.load(t.data[i]),e.push(s));return e},ne=(n,e,t,s,i)=>{let o=e;{const m=localStorage.getItem(n);m&&(o=t(m),i&&i(o))}const{subscribe:a,set:l,update:c}=u(o);return{subscribe:a,set:m=>(s&&(m=s(m)),l(m)),update:c}},g=ne("skillData",[],n=>w(be(n)),n=>(ie(n),w(n))),y=n=>{for(const e of r(g))if(e.name==n)return e},k=ne("skillFolders",[],n=>!n||n==="null"?[]:JSON.parse(n,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return y(s);const i=new f(s.data);return i.name=s.name,i}return s}}),n=>{const e=JSON.stringify(n,(t,s)=>s instanceof b||s instanceof b?s.name:t==="parent"?void 0:s);return localStorage.setItem("skillFolders",e),w(n)}),z=n=>!!y(n),H=n=>{const e=r(g),t=new b({name:n||"Skill "+(e.length+1)});return e.push(t),g.set(e),t},$e=n=>{const e=r(g);let t=n.name+" (Copy)",s=1;for(;z(t);)t=n.name+" (Copy "+s+")",s++;const i=new b;return i.load(L(n.serializeYaml().toString()).get(n.name)),i.name=t,e.push(i),g.set(e),i},Ue=n=>{const e=r(k);e.includes(n)||(x(n,e),e.push(n),e.sort((t,s)=>t.name.localeCompare(s.name)),k.set(e))},ke=n=>{const e=r(k).filter(t=>t!=n);k.set(e)},Se=n=>{const e=r(g).filter(s=>s!=n),t=r(q);g.set(e),t instanceof b&&(e.length===0?T(`${F}/`):e.find(s=>s===r(q))||T(`${F}/skill/${e[0].name}`))},E=()=>g.set(w(r(g))),Ce=()=>{k.set(w(r(k))),E()},G=n=>{const e=L(n);let t;if(e.key&&!e.data[e.key]){const s=e.key;t=z(s)?y(s):H(s),t.load(e),E();return}for(const s in e.data)s!="loaded"&&e.data[s]instanceof h&&!z(s)&&(t=z(s)?y(s):H(s),t.load(e.data[s]));E()},ve=n=>{const e=n.target?.result;e&&G(e)},$=u(!1);let U;const ie=n=>{r($)&&U&&clearTimeout(U),$.set(!0),U=setTimeout(()=>{const e=n||r(g),t=new h;t.put("loaded",!1),e.forEach(s=>t.put(s.name,s.serializeYaml())),localStorage.setItem("skillData",t.toString()),$.set(!1)},2e3)};r(g).forEach(n=>n.postLoad());class S{isClass=!0;key={};name;prefix="";group="class";manaName="&2Mana";maxLevel=40;parentStr="";_parent;get parent(){return this._parent}set parent(e){this._parent=e,this.parentStr=e?e.name:""}permission=!1;expSources=273;manaRegen=1;health=new p("health",20,1);mana=new p("mana",20,1);attributes=[];skillTree="Requirement";skills=[];icon={material:"Pumpkin",customModelData:0};unusableItems=[];actionBar="";constructor(e){this.name=e?e.name:"Class",this.prefix=e?.prefix?e.prefix:"&6"+this.name,e?.group&&(this.group=e.group),e?.manaName&&(this.manaName=e.manaName),e?.maxLevel&&(this.maxLevel=e.maxLevel),e?.parent&&(this.parent=e.parent),e?.permission&&(this.permission=e.permission),e?.expSources&&(this.expSources=e.expSources),e?.health&&(this.health=e.health),e?.mana&&(this.mana=e.mana),e?.manaRegen&&(this.manaRegen=e.manaRegen),e?.attributes&&(this.attributes=e.attributes),e?.skillTree&&(this.skillTree=e.skillTree),e?.skills&&(this.skills=e.skills),e?.icon&&(this.icon=e.icon),e?.unusableItems&&(this.unusableItems=e.unusableItems),e?.actionBar&&(this.actionBar=e.actionBar)}updateAttributes=e=>{const t=[];this.attributes=this.attributes.filter(s=>e?.includes(s.name)?(t.push(s.name),!0):!1),e=e.filter(s=>!t.includes(s));for(const s of e)this.attributes.push(new p(s,0,0))};serializeYaml=()=>{const e=new h(this.name),t=new h;return t.put("name",this.name),t.put("action-bar",this.actionBar),t.put("prefix",this.prefix),t.put("group",this.group),t.put("mana",this.manaName),t.put("max-level",this.maxLevel),t.put("parent",this.parent?.name||""),t.put("needs-permission",this.permission),t.put("attributes",[this.health,this.mana,...this.attributes]),t.put("mana-regen",this.manaRegen),t.put("skill-tree",this.skillTree.toUpperCase().replace(/ /g,"_")),t.put("blacklist",this.unusableItems),t.put("skills",this.skills.map(s=>s.name)),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore),t.put("exp-source",this.expSources),e.data=t.data,e};updateParent=e=>{this.parentStr&&(this.parent=e.find(t=>t.name===this.parentStr))};load=e=>{this.name=e.get("name",this.name),this.actionBar=e.get("action-bar",this.actionBar),this.manaName=e.get("mana",this.manaName),this.prefix=e.get("prefix",this.prefix),this.group=e.get("group",this.group),this.maxLevel=e.get("max-level",this.maxLevel),this.parentStr=e.get("parent",this.parentStr),this.permission=e.get("needs-permission",this.permission),this.attributes=e.get("attributes",this.attributes,t=>{const s=[],i=t.get("health-base",20),o=t.get("health-scale",1),a=t.get("mana-base",20),l=t.get("mana-scale",1);this.health=new p("health",i,o),this.mana=new p("mana",a,l),t.remove("health-base"),t.remove("health-scale"),t.remove("mana-base"),t.remove("mana-scale");const c={};return Object.keys(t.data).forEach(m=>{const J=m.split("-"),N=J[0];c[N]||(c[N]=new p(N,0,0));const V=c[N];J[1]=="base"&&(V.base=Number.parseFloat(t.data[m])),J[1]=="scale"&&(V.scale=Number.parseFloat(t.data[m]))}),s.push(...Object.values(c)),s}),this.manaRegen=e.get("mana-regen",this.manaRegen),this.skillTree=e.get("skill-tree",this.skillTree,me),this.unusableItems=e.get("blacklist",this.unusableItems),this.skills=e.get("skills",this.skills,t=>t.map(s=>y(s)).filter(s=>!!s)),this.icon.material=e.get("icon",this.icon.material,Z),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore),this.expSources=e.get("exp-source",this.expSources)}}const ye=n=>{const e=[],t=L(n);let s;if(t.key&&!t.data[t.key]){const i=t.key;return i==="loaded"||(s=new S({name:i}),s.load(t),e.push(s)),e}for(const i in t.data)i!="loaded"&&t.data[i]instanceof h&&(s=new S({name:i}),s.load(t.data[i]),e.push(s));return e},ae=(n,e,t,s,i)=>{let o=e;{const m=localStorage.getItem(n);m&&(o=t(m),i&&i(o))}const{subscribe:a,set:l,update:c}=u(o);return{subscribe:a,set:m=>(s&&(m=s(m)),l(m)),update:c}},d=ae("classData",[],n=>w(ye(n)),n=>(oe(n),n.forEach(e=>e.updateParent(n)),w(n)),n=>n.forEach(e=>e.updateParent(n))),M=n=>{for(const e of r(d))if(e.name==n)return e},C=ae("classFolders",[],n=>!n||n==="null"?[]:JSON.parse(n,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return M(s);const i=new f(s.data);return i.name=s.name,i}return s}}),n=>{const e=JSON.stringify(n,(t,s)=>s instanceof S||s instanceof b?s.name:t==="parent"?void 0:s);return localStorage.setItem("classFolders",e),w(n)}),Q=n=>r(d).forEach(e=>e.updateAttributes(n)),A=n=>!!M(n),W=n=>{const e=r(d),t=new S({name:n||"Class "+(e.length+1)});return e.push(t),d.set(e),t},je=n=>{const e=r(d);let t=n.name+" (Copy)",s=1;for(;A(t);)t=n.name+" (Copy "+s+")",s++;const i=new S;return i.load(L(n.serializeYaml().toString()).get(n.name)),i.name=t,e.push(i),d.set(e),i},Ge=n=>{const e=r(C);e.includes(n)||(x(n,e),e.push(n),e.sort((t,s)=>t.name.localeCompare(s.name)),C.set(e))},Oe=n=>{const e=r(C).filter(t=>t!=n);C.set(e)},Le=n=>{const e=r(d).filter(s=>s!=n),t=r(q);d.set(e),t instanceof S&&(e.length===0?T(`${F}/`):e.find(s=>s===r(q))||T(`${F}/class/${e[0].name}/edit`))},Y=()=>d.set(w(r(d))),qe=()=>{C.set(w(r(C))),Y()},K=n=>{const e=L(n);let t;if(e.key&&!e.data[e.key]){const s=e.key;t=A(s)?M(s):W(s),t.load(e),Y();return}for(const s in e.data)s!="loaded"&&e.data[s]instanceof h&&!A(s)&&(t=A(s)?M(s):W(s),t.load(e.data[s]));Y()},De=n=>{const e=n.target?.result;e&&K(e)},oe=n=>{const e=n||r(d),t=new h;t.put("loaded",!1),e.forEach(s=>t.put(s.name,s.serializeYaml())),localStorage.setItem("classData",t.toString())},Re=(()=>{let n=["vitality","spirit","intelligence","dexterity","strength"];{const i=localStorage.getItem("attribs");i&&(n=i.split(","),Q(n))}const{subscribe:e,set:t,update:s}=u(n);return{subscribe:e,set:i=>(localStorage.setItem("attribs",i.join(",")),Q(i),t(i)),update:s}})(),re=n=>{const e=L(n),t=Object.keys(e.data);Re.set(t)},q=u(void 0),Ie=O(q,n=>n instanceof S?"class":"skill"),Ke=u(),Ve=u(),I=pe("sidebarOpen",!0),He=u(!0),le=u(!0),Ne=u(!1),Qe=()=>{r(I)&&(r(Ie)=="class"?Y():E(),P())},We=()=>I.set(!r(I)),Xe=()=>I.set(!1),Ze=n=>Ne.set(n),x=(n,e)=>{const t=n.name;let s=1;for(;e.filter(i=>i instanceof f&&i.name==n.name).length>=1;)n.name=t+" ("+s+++")"},_e=n=>{n.parent?(n.parent.deleteFolder(n),P()):r(le)?Oe(n):ke(n)},et=n=>{n&&(Ae(n)?.remove(n),n instanceof S?Le(n):n instanceof b&&Se(n),P())},P=()=>{r(I)&&(r(le)?qe():Ce())},tt=()=>{oe(),ie()},ze=n=>{const e=r(C),t=r(k);e.includes(n)&&C.set(e.filter(s=>s!=n)),t.includes(n)&&k.set(t.filter(s=>s!=n))},Ae=n=>{if(n instanceof f)return n.parent;const e=n instanceof S?r(C):r(k);for(const t of e){const s=t.getContainingFolder(n);if(s)return s}},Fe=n=>{const e=n.target?.result;e&&(e.indexOf("global:")>=0?re(e):e.indexOf("components:")>=0||e.indexOf("group:")==-1&&e.indexOf("combo:")==-1&&e.indexOf("skills:")==-1?G(e):K(e),document.activeElement.blur())},st=n=>{n&&(n.indexOf("global:")>=0?re(n):n.indexOf("components:")>=0||n.indexOf("group:")==-1&&n.indexOf("combo:")==-1&&n.indexOf("skills:")==-1?(console.log("loading skills"),G(n.replace(`loaded: false
`,""))):(console.log("loading classes"),K(n.replace(`loaded: false
`,""))))},nt=n=>{const e=new FileReader;n.name.indexOf("skills")==0?e.onload=ve:n.name.indexOf("classes")==0?e.onload=De:e.onload=Fe,e.readAsText(n)},it=n=>{const e=n||r(q);e&&j(e.name+".yml",e.serializeYaml().toString())},Te=()=>{const n=r(g);n.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new h;e.put("loaded",!1);for(const t of n)e.put(t.name,t.serializeYaml());return e},Ee=()=>{const n=r(d);n.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new h;e.put("loaded",!1);for(const t of n)e.put(t.name,t.serializeYaml());return e},at=()=>{const n=Te(),e=Ee();j("skills.yml",n.toString()),j("classes.yml",e.toString())},j=(n,e)=>{const t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=n,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)};export{fe as $,Ue as A,je as B,$e as C,it as D,et as E,_e as F,ze as G,C as H,k as I,W as J,H as K,Xe as L,$ as M,at as N,I as O,p as P,Ne as Q,B as R,Be as S,Pe as T,we as U,Je as V,Ve as W,L as X,h as Y,v as Z,xe as _,nt as a,Re as a0,Qe as a1,tt as a2,me as a3,pe as a4,Ie as b,q as c,d,S as e,M as f,T as g,g as h,b as i,y as j,_ as k,st as l,ee as m,te as n,se as o,ge as p,R as q,Ae as r,Ze as s,We as t,He as u,Ke as v,P as w,f as x,le as y,Ge as z};
