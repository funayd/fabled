var Ie=Object.defineProperty;var Ce=(i,e,t)=>e in i?Ie(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var o=(i,e,t)=>(Ce(i,typeof e!="symbol"?e+"":e,t),t);import{w as f,d as O,g as M,b as B}from"./entry.JzkcjCUA.js";import{Q as a}from"./scheduler.DiZXyGup.js";const se={INT:/^-?[0-9]+$/,FLOAT:/^-?[0-9]+\.[0-9]+$/,SPACE:/^( +)/},y=i=>{i=i.replace(/\r\n/g,`
`).replace(/\n *\n/g,`
`).replace(/ +\n/g,`
`);const e=new c,t=0,s=i.split(`
`);return e.parse(s,t,0),e},D=i=>{const e=i.match(se.SPACE);return e?e[1].length:0};class ye{constructor(e){o(this,"data");o(this,"set",e=>this.data=e);o(this,"get",()=>this.data);this.data=e}}class c{constructor(e){o(this,"key");o(this,"data",{});o(this,"put",(e,t)=>{this.data[e]=t});o(this,"has",e=>this.data[e]!==void 0);o(this,"get",(e,t,s)=>((this.data[e]=="[]"||this.data[e]==" []")&&(this.data[e]=JSON.parse(this.data[e].trim())),this.has(e)?s?s(this.data[e]):this.data[e]:t));o(this,"getKeys",()=>Object.keys(this.data));o(this,"remove",e=>{delete this.data[e]});o(this,"parse",(e,t,s,n)=>{for(n&&(this.key=n);t<e.length&&D(e[t])>=s;){for(;t<e.length&&(D(e[t])!=s||e[t].replace(/ /g,"").charAt(0)=="#"||e[t].indexOf(":")==-1);)t++;if(t==e.length)break;let r=e[t].substring(s,e[t].indexOf(":"));if(r==="loaded"){t++;continue}if(r.match(/^["'].*["']$/)&&(r=r.substring(1,r.length-1)),!this.key&&!n&&(this.key=r),e[t].search(/: +\{\}/)!=-1&&e[t].length>=4)s===0&&console.log("empty section"),this.data[r]=new c(r);else if(t<e.length-1&&e[t+1].charAt(s)=="-"&&e[t+1].charAt(s+1)==" "&&D(e[t+1])==s){const l=[];for(;++t<e.length&&e[t].charAt(s)=="-";){let h=e[t].substring(s+2);(h.charAt(0)=="'"||h.charAt(0)=='"')&&(h=h.substring(1,h.length-1).replace(/\\(['"])/,m=>m.replace("\\",""))),l.push(h)}this.data[r]=l,t--}else if(t<e.length-1&&D(e[t+1])>s){t++;const l=D(e[t]),h=new c;t=h.parse(e,t,l,r)-1,this.data[r]=h}else{let l=e[t].substring(e[t].indexOf(":")+2);l.charAt(0)=="'"||l.charAt(0)=='"'?l=l.substring(1,l.length-1):isNaN(l)||(se.INT.test(l)?l=parseInt(l):l=parseFloat(l)),typeof l=="string"&&(l.toLowerCase()=="false"?l=!1:l.toLowerCase()=="true"?l=!0:l=l.replace(/\\(['"])/,h=>h.replace("\\",""))),this.data[r]=l}do t++;while(t<e.length&&e[t].replace(/ /g,"").charAt(0)=="#")}return Object.keys(this.data).length==1&&this.key&&this.data[this.key]instanceof c&&(this.data=this.data[this.key].data),t});o(this,"toString",()=>this.toYaml(this.key||this.data.name?"'"+(this.key||this.data.name)+"'":void 0,this.data));o(this,"toYaml",(e,t,s=new ye("a"),n="")=>{if(t instanceof c)return t.toYaml("'"+(e??t.key)+"'",t.data,s,n);let r="";e&&(r+=n+e+`:
`,n+="  ");for(const l of Object.keys(t)){const h=t[l];let m="";if(h!=null){if(h instanceof Object)if(Object.keys(h).includes("toYaml"))if(h instanceof c){r+=h.toYaml("'"+l+"'",h.data,s,n);continue}else m=h.toYaml(n);else h instanceof Array&&(m=this.convertArray(l,s,n,h));else{const p=JSON.stringify(h);m=n+l+": "+p+`
`}m&&(r+=m.replaceAll(/(\\)?'/g,"\\'").replaceAll(/((\\)?")/g,p=>p.length==1?"'":p).replaceAll(/\\"/g,'"').replace(/\\\\/g,"\\"))}}return r});o(this,"nextChar",e=>/z+/.test(e)?e.replaceAll(/z/g,"a")+"a":e.substring(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1));this.key=e}convertArray(e,t,s,n){if(e!="attributes"){let r=s+e+":";if(["string","number"].includes(typeof n[0]))n.length>0?(r+=`
`,n.forEach(l=>r+=s+"- "+JSON.stringify(l)+`
`)):r+=` []
`;else if(e==="components"||e==="children")if(n.length==0)r+=` {}
`;else return r+=`
`,n.forEach(l=>{const h=t.get();t.set(this.nextChar(t.get())),r+=this.toYaml(l.name+"-"+h,l.toYamlObj(),t,s+"  ")}),r.replaceAll(/'/g,'"');else r+=` []
`;return r}else return this.toYaml(e,n,t,s)}}class u{constructor(e,t,s){o(this,"name");o(this,"base");o(this,"scale");o(this,"toYaml",(e="")=>e+this.name.toLowerCase()+"-base: "+this.base+`
`+e+this.name.toLowerCase()+"-scale: "+this.scale+`
`);this.name=e,this.base=t,this.scale=s}}class g{constructor(e){o(this,"location","local");o(this,"dataType","folder");o(this,"key",{});o(this,"open",!1);o(this,"name","Folder");o(this,"data",[]);o(this,"parent");o(this,"updateParent",e=>{this.parent=e});o(this,"add",e=>{this.data.includes(e)||(e instanceof g&&(Q(e,this.data),Pe(e),e.parent=this),this.data.push(e),this.sort())});o(this,"remove",e=>{this.data=this.data.filter(t=>t!=e),this.sort()});o(this,"sort",()=>{this.data=this.data.sort((e,t)=>{let s=0;return e instanceof g&&(t instanceof g||(s=-100)),e.name.localeCompare(t.name)+s}),j()});o(this,"createFolder",()=>{const e=new g;Q(e,this.data),this.data.push(e),this.sort(),e.updateParent(this)});o(this,"deleteFolder",e=>{this.data=this.data.filter(t=>t!=e)});o(this,"contains",e=>{if(this.data.includes(e))return!0;for(const t of this.data.filter(s=>s instanceof g))if(t.contains(e))return!0;return!1});o(this,"getContainingFolder",e=>{if(this.data.includes(e))return this;for(const t of this.data.filter(s=>s instanceof g)){if(t.data.includes(e))return t;{const s=t.getContainingFolder(e);if(!s)continue;return s}}});o(this,"getSubfolder",(e,t=!1)=>{for(const s of this.data.filter(n=>n instanceof g)){if(s.name===e)return s;if(t){const n=s.getSubfolder(e);if(!n)continue;return n}}});e&&(this.data=e,e.forEach(t=>{t instanceof g&&t.updateParent(this)}))}}const Le=i=>i.replace("_"," ").toLowerCase().replace(/^(.)|\s(.)/g,e=>e.toUpperCase()),ie=i=>(i=i.replace("_"," "),i.substring(0,1).toUpperCase()+i.substring(1).toLowerCase()),b=i=>i.sort((e,t)=>e.name.localeCompare(t.name)),qe=(i,e)=>{let t=e;localStorage.getItem(i)===null&&(typeof e=="string"||typeof e=="number"||typeof e=="boolean"?localStorage.setItem(i,e.toString()):localStorage.setItem(i,JSON.stringify(e))),typeof e=="number"?t=parseInt(localStorage.getItem(i)):typeof e=="boolean"?t=localStorage.getItem(i)==="true":typeof e=="string"?t=localStorage.getItem(i):t=JSON.parse(localStorage.getItem(i));const{subscribe:s,set:n,update:r}=f(t);return{subscribe:s,set:l=>(typeof l=="string"||typeof l=="number"||typeof l=="boolean"?localStorage.setItem(i,l.toString()):localStorage.setItem(i,JSON.stringify(l)),n(l)),update:r}};class ne{}o(ne,"new",()=>{throw new Error("'new' method not implemented")});class Oe extends ne{constructor(t,s){super();o(this,"type");o(this,"name");o(this,"description");o(this,"comment");o(this,"components",f([]));o(this,"data",[]);o(this,"preview",[]);o(this,"enablePreview",!1);o(this,"summaryItems",[]);o(this,"isParent",!0);o(this,"isDeprecated",!1);o(this,"id",{});o(this,"_defaultOpen",!1);o(this,"parent");o(this,"setComponents",t=>{t.forEach(s=>s.parent=this),this.components.set([...t])});o(this,"contains",t=>{const s=a(this.components);if(s.includes(t))return!0;for(const n of s)if(n.contains(t))return!0;return!1});o(this,"addComponent",(t,s=-1)=>{const n=a(this.components);s==-1?n.push(t):n.splice(s,0,t),this.setComponents(n)});o(this,"removeComponent",t=>{const s=a(this.components);if(s.includes(t)){s.splice(s.indexOf(t),1),t.parent=void 0,this.setComponents(s);return}for(const n of s)n.contains(t)&&n.removeComponent(t)});o(this,"defaultOpen",()=>(this._defaultOpen=!0,this));this.type=t,this.name=s.name,this.description=s.description??"",this.summaryItems=s.summaryItems??[],this.comment=s.comment??"",this.setComponents(s.components||[]),this.data=s.data||[],this.preview=s.preview||[]}getValue(t){var n;const s=(n=this.data)==null?void 0:n.find(r=>r.key==t);return!s||!s.meetsRequirements(this)?"":s.getSummary()}toYamlObj(){const t=new c(this.name);if(t.put("type",this.type),t.put("comment",this.comment),this.preview.length>0){const s=new c("preview");s.put("enabled",this.enablePreview),this.preview.filter(n=>n.meetsPreviewRequirements(this)).forEach(n=>{const r=n.getData();Object.keys(r).forEach(l=>s.put(l,r[l]))}),t.put("preview",s)}return t}getRawPreviewData(){const t=new c("preview");return this.preview.forEach(s=>{const n=s.getData();Object.keys(n).forEach(r=>t.put(r,n[r]))}),t}deserialize(t){const s=t.get("preview");s&&(this.enablePreview=s.get("enabled",!1),this.preview.forEach(n=>n.deserialize(s))),this.comment=t.get("comment","").replaceAll("\\n",`
`)}}const oe=f({}),re=f({}),le=f({}),ae=f({}),ce=f(!1),U=f(""),Ne=O([oe,U],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),Ve=O(Ne,i=>{const e={};return i.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),He=O([re,U],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),Xe=O([le,U],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),Re=O([ae,U],([i,e])=>Object.keys(i).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,n)=>(i[s].component.new().isDeprecated?0:-1)-(i[n].component.new().isDeprecated?0:-1)).map(s=>i[s])),Ze=O(Re,i=>{const e={};return i.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),d=class d{};o(d,"getTriggerByName",e=>{var s;return(s=Object.values(a(oe)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),o(d,"getTargetByName",e=>{var s;return(s=Object.values(a(re)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),o(d,"getConditionByName",e=>{var s;return(s=Object.values(a(le)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),o(d,"getMechanicByName",e=>{var s;return(s=Object.values(a(ae)).find(n=>{var r;return n.name.toLowerCase()===e.toLowerCase()||((r=n.alias)==null?void 0:r.toLowerCase())===e.toLowerCase()}))==null?void 0:s.component}),o(d,"deserializeComponents",e=>{if(!e||!(e instanceof c))return[];const t=[],s=e.getKeys();for(const n of s){let r;const l=e.get(n),h=l.get("type");if(h==="trigger"){const m=d.getTriggerByName(n.split("-")[0]);m&&(r=m.new())}else if(h==="target"){const m=d.getTargetByName(n.split("-")[0]);m&&(r=m.new())}else if(h==="condition"){const m=d.getConditionByName(n.split("-")[0]);m&&(r=m.new())}else if(h==="mechanic"){const m=d.getMechanicByName(n.split("-")[0]);m&&(r=m.new())}r&&(r.deserialize(l),t.push(r))}return t});let A=d;const T=class T extends Oe{constructor(t,s=!1){super("trigger",t);o(this,"mana",!1);o(this,"cooldown",!1);o(this,"clone",()=>new T({name:this.name,components:[...a(this.components)],mana:this.mana,cooldown:this.cooldown,data:[...this.data],preview:[...this.preview],comment:this.comment,description:this.description,summaryItems:[...this.summaryItems]}));this.mana=t.mana||!1,this.cooldown=t.cooldown||!1,super.isDeprecated=s}toYamlObj(){const t=super.toYamlObj(),s=this.getData();s.getKeys().length>0&&t.put("data",s);const n=a(this.components);return n.length>0&&t.put("children",n),t}getData(){const t=new c("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(t.put("mana",this.mana),t.put("cooldown",this.cooldown)),this.data.filter(s=>s.meetsRequirements(this)).forEach(s=>{const n=s.getData();Object.keys(n).forEach(r=>t.put(r,n[r]))}),t}getRawData(){const t=new c("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(t.put("mana",this.mana),t.put("cooldown",this.cooldown)),this.data.forEach(s=>{const n=s.getData();Object.keys(n).forEach(r=>t.put(r,n[r]))}),t}deserialize(t){super.deserialize(t);const s=t.get("data");s&&(this.mana=s.get("mana",!1),this.cooldown=s.get("cooldown",!1),this.data.forEach(n=>n.deserialize(s))),this.setComponents(t.get("children",[],n=>A.deserializeComponents(n)))}};o(T,"new",()=>new T({name:"null"}));let Y=T;class S{constructor(e){o(this,"dataType","skill");o(this,"location","local");o(this,"loaded",!1);o(this,"tooBig",!1);o(this,"acknowledged",!1);o(this,"isSkill",!0);o(this,"key",{});o(this,"name");o(this,"previousName","");o(this,"type","Dynamic");o(this,"maxLevel",5);o(this,"skillReq");o(this,"skillReqLevel",0);o(this,"attributeRequirements",[]);o(this,"permission",!1);o(this,"levelReq",new u("level",1,0));o(this,"cost",new u("cost",1,0));o(this,"cooldown",new u("cooldown",0,0));o(this,"cooldownMessage",!0);o(this,"mana",new u("mana",0,0));o(this,"minSpent",new u("points-spent-req",0,0));o(this,"castMessage","&6{player} &2has cast &6{skill}");o(this,"combo","");o(this,"icon",{material:"Pumpkin",customModelData:0,lore:["&d{name} &7({level}/{max})","&2Type: &6{type}","","{req:level}Level: {attr:level}","{req:cost}Cost: {attr:cost}","","&2Mana: {attr:mana}","&2Cooldown: {attr:cooldown}"]});o(this,"incompatible",[]);o(this,"triggers",[]);o(this,"skillReqStr","");o(this,"incompStr",[]);o(this,"addComponent",e=>{var t;if(e instanceof Y){this.triggers=[...this.triggers,e];return}this.triggers.length===0&&this.triggers.push((t=A.getTriggerByName("cast"))==null?void 0:t.new()),this.triggers[0].addComponent(e),this.triggers=[...this.triggers]});o(this,"removeComponent",e=>{if(e instanceof Y&&this.triggers.includes(e)){this.triggers.splice(this.triggers.indexOf(e),1);return}for(const t of this.triggers)t.contains(e)&&t.removeComponent(e);this.triggers=[...this.triggers]});o(this,"serializeYaml",()=>{var n;const e=new c(this.name),t=new c;t.put("name",this.name),t.put("type",this.type),t.put("max-level",this.maxLevel),t.put("skill-req",(n=this.skillReq)==null?void 0:n.name),t.put("skill-req-lvl",this.skillReqLevel),t.put("needs-permission",this.permission),t.put("cooldown-message",this.cooldownMessage),t.put("msg",this.castMessage),t.put("combo",this.combo),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore);const s=new c("attributes");return s.put("level",this.levelReq),s.put("cost",this.cost),s.put("cooldown",this.cooldown),s.put("mana",this.mana),s.put("points-spent-req",this.minSpent),s.put("incompatible",this.incompatible.map(r=>r.name)),this.attributeRequirements.forEach(r=>s.put(r.name.toLowerCase(),r)),t.put("attributes",s),t.put("components",this.triggers),e.data=t.data,e});o(this,"load",e=>{this.name=e.get("name",this.name),this.type=e.get("type",this.type),this.maxLevel=e.get("max-level",this.maxLevel),this.skillReqStr=e.get("skill-req",this.skillReqStr),this.skillReqLevel=e.get("skill-req-lvl",this.skillReqLevel),this.permission=e.get("needs-permission",this.permission),this.cooldownMessage=e.get("cooldown-message",this.cooldownMessage),this.castMessage=e.get("msg",this.castMessage),this.combo=e.get("combo",this.combo);const t=e.get("attributes");this.levelReq=new u("level",t.get("level-base"),t.get("level-scale")),this.cost=new u("cost",t.get("cost-base"),t.get("cost-scale")),this.cooldown=new u("cooldown",t.get("cooldown-base"),t.get("cooldown-scale")),this.mana=new u("mana",t.get("mana-base"),t.get("mana-scale")),this.minSpent=new u("points-spent-req",t.get("points-spent-req-base"),t.get("points-spent-req-scale")),this.incompStr=t.get("incompatible",this.incompStr);const s=["level","cost","cooldown","mana","points-spent-req","incompatible"],n=new Set(t.getKeys().map(l=>l.replace(/-(base|scale)/i,"")).filter(l=>!s.includes(l)));this.attributeRequirements=[...n].map(l=>new u(l,t.get(l+"-base"),t.get(l+"-scale"))),this.icon.material=e.get("icon",this.icon.material,ie),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore);let r;r=ce.subscribe(l=>{l&&(this.triggers=e.get("components",this.triggers,h=>A.deserializeComponents(h)),r&&r())}),this.loaded=!0});o(this,"postLoad",()=>{this.skillReq=q(this.skillReqStr),this.incompatible=this.incompStr.map(e=>q(e)).filter(e=>!!e)});o(this,"save",()=>{var t;if(!this.name||this.tooBig)return;if(this.tooBig&&!this.acknowledged){te.set(this);return}E.set(!0);const e=this.serializeYaml();if(this.location!=="server"){this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.skill."+this.previousName),this.previousName=this.name;try{localStorage.setItem("sapi.skill."+this.name,e.toString()),this.tooBig=!1}catch(s){(t=s==null?void 0:s.message)!=null&&t.includes("quota")?(localStorage.removeItem("sapi.skill."+this.name),this.tooBig=!0,te.set(this)):console.error(this.name+" Save error",s)}E.set(!1)}});this.name=(e==null?void 0:e.name)||"Skill",e&&(e.location&&(this.location=e.location),e.type&&(this.type=e.type),e.maxLevel&&(this.maxLevel=e.maxLevel),e.skillReq&&(this.skillReq=e.skillReq),e.skillReqLevel&&(this.skillReqLevel=e.skillReqLevel),e.attributeRequirements&&(this.attributeRequirements=e.attributeRequirements.map(t=>new u(t.name,t.base,t.scale))),e.permission&&(this.permission=e.permission),e.levelReq&&(this.levelReq=e.levelReq),e.cost&&(this.cost=e.cost),e.cooldown&&(this.cooldown=e.cooldown),e.cooldownMessage&&(this.cooldownMessage=e.cooldownMessage),e.mana&&(this.mana=e.mana),e.minSpent&&(this.minSpent=e.minSpent),e.castMessage&&(this.castMessage=e.castMessage),e.combo&&(this.combo=e.combo),e.icon&&(this.icon=e.icon),e.incompatible&&(this.incompatible=e.incompatible),e.triggers&&(this.triggers=e.triggers))}}let he=!1;const We=i=>{const e=[],t=y(i);let s;if(t.key&&!t.data[t.key]){const n=t.key;return n==="loaded"||(s=new S({name:n}),s.load(t),e.push(s)),e}for(const n in t.data)n!="loaded"&&t.data[n]instanceof c&&(s=new S({name:n}),s.load(t.data[n]),e.push(s));return e},me=(i,e,t,s,n)=>{let r=e;{const p=localStorage.getItem(i);p&&(r=t(p),n&&n(r))}const{subscribe:l,set:h,update:m}=f(r);return{subscribe:l,set:p=>(s&&(p=s(p)),h(p)),update:m}},v=me(localStorage.getItem("skillNames")?"skillNames":"skillData",[],i=>localStorage.getItem("skillNames")?i.split(", ").map(e=>new S({name:e,location:"local"})).filter(e=>localStorage.getItem("sapi.skill."+e.name)):(localStorage.removeItem("skillData"),he=!0,b(We(i))),i=>(ue(),b(i))),q=i=>{for(const e of a(v))if(e.name==i)return e},I=me("skillFolders",[],i=>!i||i==="null"?[]:JSON.parse(i,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return q(s);const n=new g(s.data);return n.name=s.name,n}return s}}),i=>{const e=JSON.stringify(i,(t,s)=>s instanceof S||s instanceof S?s.name:t==="parent"?void 0:s);return localStorage.setItem("skillFolders",e),b(i)}),z=i=>!!q(i),Z=i=>{const e=a(v);let t=e.length+1;for(;!i&&z(i||"Skill "+t);)t++;const s=new S({name:i||"Skill "+t});return e.push(s),v.set(e),s.save(),s},pe=i=>{i.loaded||(i.location==="local"&&i.load(y(localStorage.getItem(`sapi.skill.${i.name}`)||"")),i.postLoad())},_e=i=>{i.loaded||pe(i);const e=a(v);let t=i.name+" (Copy)",s=1;for(;z(t);)t=i.name+" (Copy "+s+")",s++;const n=new S;return n.load(y(i.serializeYaml().toString())),n.name=t,e.push(n),v.set(e),n.save(),n},et=i=>{const e=a(I);e.includes(i)||(Q(i,e),e.push(i),e.sort((t,s)=>t.name.localeCompare(s.name)),I.set(e))},fe=(i,e)=>{const t=a(I).filter(s=>s!=i);i.data.forEach(s=>{if(s instanceof g){if(e&&e(s)){fe(s,e);return}i.parent?i.parent.add(s):(s.updateParent(),t.push(s))}else i.parent&&i.parent.add(s)}),I.set(t)},De=i=>{const e=a(v).filter(s=>s!=i),t=a(W);v.set(e),localStorage.removeItem("sapi.skill."+i.name),t instanceof S&&(e.length===0?M(`${B}/`):e.find(s=>s===a(W))||M(`${B}/skill/${e[0].name}`))},P=()=>v.set(b(a(v))),ze=()=>{I.set(b(a(I))),P()},V=async(i,e=!1)=>{const t=y(i);console.log(t);let s;if(t.key&&!t.data[t.key]){const n=t.key;s=z(n)?q(n):Z(n),e&&(s.location="server"),s.load(t),s.save(),P();return}for(const n in t.data)n!="loaded"&&t.data[n]instanceof c&&!z(n)&&(s=z(n)?q(n):Z(n),s.load(t.data[n]),s.save());P()},Ee=async i=>{var t;const e=(t=i.target)==null?void 0:t.result;e&&await V(e)},E=f(!1);let G;const ue=i=>{a(E)&&G&&clearTimeout(G),E.set(!0),G=setTimeout(()=>{const e=(i||a(v)).filter(t=>t.location==="local");localStorage.setItem("skillNames",e.map(t=>t.name).join(", ")),E.set(!1)})};a(v).forEach(i=>{i.loaded&&i.postLoad()});if(he){const i=ce.subscribe(e=>{e&&(a(v).forEach(t=>{t.location==="local"&&t.save()}),ue(),i&&i())})}class k{constructor(e){o(this,"dataType","class");o(this,"location","local");o(this,"loaded",!1);o(this,"isClass",!0);o(this,"key",{});o(this,"name");o(this,"previousName","");o(this,"prefix","");o(this,"group","class");o(this,"manaName","&2Mana");o(this,"maxLevel",40);o(this,"parentStr","");o(this,"_parent");o(this,"permission",!1);o(this,"expSources",273);o(this,"manaRegen",1);o(this,"health",new u("health",20,1));o(this,"mana",new u("mana",20,1));o(this,"attributes",[]);o(this,"skillTree","Requirement");o(this,"skills",[]);o(this,"icon",{material:"Pumpkin",customModelData:0});o(this,"unusableItems",[]);o(this,"actionBar","");o(this,"lInverted",!1);o(this,"rInverted",!1);o(this,"lsInverted",!1);o(this,"rsInverted",!1);o(this,"pInverted",!1);o(this,"qInverted",!1);o(this,"fInverted",!1);o(this,"lWhitelist",[]);o(this,"rWhitelist",[]);o(this,"lsWhitelist",[]);o(this,"rsWhitelist",[]);o(this,"pWhitelist",[]);o(this,"qWhitelist",[]);o(this,"fWhitelist",[]);o(this,"updateAttributes",e=>{const t=[];this.attributes=this.attributes.filter(s=>e!=null&&e.includes(s.name)?(t.push(s.name),!0):!1),e=e.filter(s=>!t.includes(s));for(const s of e)this.attributes.push(new u(s,0,0))});o(this,"serializeYaml",()=>{var N;const e=new c(this.name),t=new c;t.put("name",this.name),t.put("action-bar",this.actionBar),t.put("prefix",this.prefix),t.put("group",this.group),t.put("mana",this.manaName),t.put("max-level",this.maxLevel),t.put("parent",((N=this.parent)==null?void 0:N.name)||""),t.put("needs-permission",this.permission),t.put("attributes",[this.health,this.mana,...this.attributes]),t.put("mana-regen",this.manaRegen),t.put("skill-tree",this.skillTree.toUpperCase().replace(/ /g,"_")),t.put("blacklist",this.unusableItems),t.put("skills",this.skills.map(R=>R.name)),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore),t.put("exp-source",this.expSources);const s=new c("combo-starters"),n=new c("L");n.put("inverted",this.lInverted),n.put("whitelist",this.lWhitelist),s.put("L",n);const r=new c("R");r.put("inverted",this.rInverted),r.put("whitelist",this.rWhitelist),s.put("R",r);const l=new c("LS");l.put("inverted",this.lsInverted),l.put("whitelist",this.lsWhitelist),s.put("LS",l);const h=new c("RS");h.put("inverted",this.rsInverted),h.put("whitelist",this.rsWhitelist),s.put("RS",h);const m=new c("P");m.put("inverted",this.pInverted),m.put("whitelist",this.pWhitelist),s.put("P",m);const p=new c("Q");p.put("inverted",this.qInverted),p.put("whitelist",this.qWhitelist),s.put("Q",p);const L=new c("F");return L.put("inverted",this.fInverted),L.put("whitelist",this.fWhitelist),s.put("F",L),t.put("combo-starters",s),e.data=t.data,e});o(this,"updateParent",e=>{this.parentStr&&(this.parent=e.find(t=>t.name===this.parentStr))});o(this,"load",e=>{this.name=e.get("name",this.name),this.actionBar=e.get("action-bar",this.actionBar),this.manaName=e.get("mana",this.manaName),this.prefix=e.get("prefix",this.prefix),this.group=e.get("group",this.group),this.maxLevel=e.get("max-level",this.maxLevel),this.parentStr=e.get("parent",this.parentStr),this.permission=e.get("needs-permission",this.permission),this.attributes=e.get("attributes",this.attributes,s=>{const n=[],r=s.get("health-base",20),l=s.get("health-scale",1),h=s.get("mana-base",20),m=s.get("mana-scale",1);this.health=new u("health",r,l),this.mana=new u("mana",h,m),s.remove("health-base"),s.remove("health-scale"),s.remove("mana-base"),s.remove("mana-scale");const p={};return Object.keys(s.data).forEach(L=>{const N=L.split("-"),R=N[0];p[R]||(p[R]=new u(R,0,0));const X=p[R];N[1]=="base"&&(X.base=Number.parseFloat(s.data[L])),N[1]=="scale"&&(X.scale=Number.parseFloat(s.data[L]))}),n.push(...Object.values(p)),n}),this.manaRegen=e.get("mana-regen",this.manaRegen),this.skillTree=e.get("skill-tree",this.skillTree,Le),this.unusableItems=e.get("blacklist",this.unusableItems),this.skills=e.get("skills",this.skills,s=>s.map(n=>q(n)).filter(n=>!!n)),this.icon.material=e.get("icon",this.icon.material,ie),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore),this.expSources=e.get("exp-source",this.expSources);const t=e.get("combo-starters",new c);this.lInverted=t.get("L",new c).get("inverted",this.lInverted),this.rInverted=t.get("R",new c).get("inverted",this.rInverted),this.lsInverted=t.get("LS",new c).get("inverted",this.lsInverted),this.rsInverted=t.get("RS",new c).get("inverted",this.rsInverted),this.pInverted=t.get("P",new c).get("inverted",this.pInverted),this.qInverted=t.get("Q",new c).get("inverted",this.qInverted),this.fInverted=t.get("F",new c).get("inverted",this.fInverted),this.lWhitelist=t.get("L",new c).get("whitelist",this.lWhitelist),this.rWhitelist=t.get("R",new c).get("whitelist",this.rWhitelist),this.lsWhitelist=t.get("LS",new c).get("whitelist",this.lsWhitelist),this.rsWhitelist=t.get("RS",new c).get("whitelist",this.rsWhitelist),this.pWhitelist=t.get("P",new c).get("whitelist",this.pWhitelist),this.qWhitelist=t.get("Q",new c).get("whitelist",this.qWhitelist),this.fWhitelist=t.get("F",new c).get("whitelist",this.fWhitelist),this.loaded=!0});o(this,"save",()=>{if(!this.name||this.location==="server")return;const e=this.serializeYaml();this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.class."+this.previousName),this.previousName=this.name,localStorage.setItem("sapi.class."+this.name,e.toString())});this.name=e?e.name:"Class",this.prefix=e!=null&&e.prefix?e.prefix:"&6"+this.name,e&&(e!=null&&e.location&&(this.location=e.location),e!=null&&e.group&&(this.group=e.group),e!=null&&e.manaName&&(this.manaName=e.manaName),e!=null&&e.maxLevel&&(this.maxLevel=e.maxLevel),e!=null&&e.parent&&(this.parent=e.parent),e!=null&&e.permission&&(this.permission=e.permission),e!=null&&e.expSources&&(this.expSources=e.expSources),e!=null&&e.health&&(this.health=e.health),e!=null&&e.mana&&(this.mana=e.mana),e!=null&&e.manaRegen&&(this.manaRegen=e.manaRegen),e!=null&&e.attributes&&(this.attributes=e.attributes),e!=null&&e.skillTree&&(this.skillTree=e.skillTree),e!=null&&e.skills&&(this.skills=e.skills),e!=null&&e.icon&&(this.icon=e.icon),e!=null&&e.unusableItems&&(this.unusableItems=e.unusableItems),e!=null&&e.actionBar&&(this.actionBar=e.actionBar),e!=null&&e.lInverted&&(this.lInverted=e.lInverted),e!=null&&e.rInverted&&(this.rInverted=e.rInverted),e!=null&&e.lsInverted&&(this.lsInverted=e.lsInverted),e!=null&&e.rsInverted&&(this.rsInverted=e.rsInverted),e!=null&&e.pInverted&&(this.pInverted=e.pInverted),e!=null&&e.qInverted&&(this.qInverted=e.qInverted),e!=null&&e.fInverted&&(this.fInverted=e.fInverted),e!=null&&e.lWhitelist&&(this.lWhitelist=e.lWhitelist),e!=null&&e.rWhitelist&&(this.rWhitelist=e.rWhitelist),e!=null&&e.lsWhitelist&&(this.lsWhitelist=e.lsWhitelist),e!=null&&e.rsWhitelist&&(this.rsWhitelist=e.rsWhitelist),e!=null&&e.pWhitelist&&(this.pWhitelist=e.pWhitelist),e!=null&&e.qWhitelist&&(this.qWhitelist=e.qWhitelist),e!=null&&e.fWhitelist&&(this.fWhitelist=e.fWhitelist))}get parent(){return this._parent}set parent(e){this._parent=e,this.parentStr=e?e.name:""}}let ge=!1;const Fe=i=>{const e=[],t=y(i);let s;if(t.key&&!t.data[t.key]){const n=t.key;return n==="loaded"||(s=new k({name:n}),s.load(t),e.push(s)),e}for(const n in t.data)n!="loaded"&&t.data[n]instanceof c&&(s=new k({name:n}),s.load(t.data[n]),e.push(s));return e},we=(i,e,t,s,n)=>{let r=e;{const p=localStorage.getItem(i);p&&(r=t(p),n&&n(r))}const{subscribe:l,set:h,update:m}=f(r);return{subscribe:l,set:p=>(s&&(p=s(p)),h(p)),update:m}},w=we(localStorage.getItem("classNames")?"classNames":"classData",[],i=>localStorage.getItem("classNames")?i.split(", ").map(e=>new k({name:e,location:"local"})).filter(e=>localStorage.getItem("sapi.class."+e.name)):(localStorage.removeItem("classData"),ge=!0,b(Fe(i))),i=>(be(i),i.forEach(e=>e.updateParent(i)),b(i)),i=>i.forEach(e=>e.updateParent(i))),$=i=>{for(const e of a(w))if(e.name==i)return e},C=we("classFolders",[],i=>!i||i==="null"?[]:JSON.parse(i,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return $(s);const n=new g(s.data);return n.name=s.name,n}return s}}),i=>{const e=JSON.stringify(i,(t,s)=>s instanceof k||s instanceof S?s.name:t==="parent"?void 0:s);return localStorage.setItem("classFolders",e),b(i)}),_=i=>a(w).forEach(e=>e.updateAttributes(i)),F=i=>!!$(i),ee=i=>{const e=a(w);let t=e.length+1;for(;!i&&F(i||"Class "+t);)t++;const s=new k({name:i||"Class "+t});return e.push(s),w.set(e),s.save(),s},ve=i=>{i.loaded||(i.location==="local"&&i.load(y(localStorage.getItem(`sapi.class.${i.name}`)||"")),i.updateParent(a(w)),i.loaded=!0)},tt=i=>{i.loaded||ve(i);const e=a(w);let t=i.name+" (Copy)",s=1;for(;F(t);)t=i.name+" (Copy "+s+")",s++;const n=new k;return n.load(y(i.serializeYaml().toString())),n.name=t,e.push(n),w.set(e),n.save(),n},st=i=>{const e=a(C);e.includes(i)||(Q(i,e),e.push(i),e.sort((t,s)=>t.name.localeCompare(s.name)),C.set(e))},de=(i,e)=>{const t=a(C).filter(s=>s!=i);i.data.forEach(s=>{if(s instanceof g){if(e&&e(s)){de(s,e);return}i.parent?i.parent.add(s):(s.updateParent(),t.push(s))}else i.parent&&i.parent.add(s)}),C.set(t)},Te=i=>{const e=a(w).filter(s=>s!=i),t=a(W);w.set(e),localStorage.removeItem("sapi.class."+i.name),t instanceof k&&(e.length===0?M(`${B}/`):e.find(s=>s===a(W))||M(`${B}/class/${e[0].name}/edit`))},J=()=>w.set(b(a(w))),Ae=()=>{C.set(b(a(C))),J()},H=(i,e=!1)=>{const t=y(i);let s;if(t.key&&!t.data[t.key]){const n=t.key;s=F(n)?$(n):ee(n),e&&(s.location="server"),s.load(t),J();return}for(const n in t.data)n!="loaded"&&t.data[n]instanceof c&&!F(n)&&(s=F(n)?$(n):ee(n),s.load(t.data[n]));J()},xe=i=>{var t;const e=(t=i.target)==null?void 0:t.result;e&&H(e)},be=i=>{const e=(i||a(w)).filter(t=>t.location==="local");localStorage.setItem("classNames",e.map(t=>t.name).join(", "))};ge&&(a(w).forEach(i=>{i.location==="local"&&i.save()}),be());const Me=(()=>{let i=["vitality","spirit","intelligence","dexterity","strength"];{const n=localStorage.getItem("attribs");n&&(i=n.split(","),_(i))}const{subscribe:e,set:t,update:s}=f(i);return{subscribe:e,set:n=>(localStorage.setItem("attribs",n.join(",")),_(n),t(n)),update:s}})(),ke=i=>{const e=y(i),t=Object.keys(e.data);Me.set(t)},W=f(void 0),Be=O(W,i=>i instanceof k?"class":"skill"),it=f(),nt=f(),x=qe("sidebarOpen",!0),ot=f(!0),Se=f(!0),Ye=f(!1),rt=()=>{a(x)&&(a(Be)=="class"?J():P(),j())},lt=()=>x.set(!a(x)),at=()=>x.set(!1),ct=i=>Ye.set(i),Q=(i,e)=>{const t=i.name;let s=1;for(;e.filter(n=>n instanceof g&&n.name==i.name).length>=1;)i.name=t+" ("+s+++")"},ht=i=>{i.parent?(i.parent.deleteFolder(i),j()):a(Se)?de(i,()=>!1):fe(i,()=>!1)},mt=i=>{var e;i&&((e=$e(i))==null||e.remove(i),i instanceof k?Te(i):De(i),j())},j=()=>{a(x)&&(a(Se)?Ae():ze())},Pe=i=>{const e=a(C),t=a(I);e.includes(i)&&C.set(e.filter(s=>s!=i)),t.includes(i)&&I.set(t.filter(s=>s!=i))},$e=i=>{if(!i)return;if(i instanceof g)return i.parent;const e=i instanceof k?a(C):a(I);for(const t of e){const s=t.getContainingFolder(i);if(s)return s}},Je=async i=>{var t;const e=(t=i.target)==null?void 0:t.result;e&&(e.indexOf("global:")>=0?ke(e):e.indexOf("components:")>=0||e.indexOf("group:")==-1&&e.indexOf("combo:")==-1&&e.indexOf("skills:")==-1?await V(e):H(e),document.activeElement.blur())},pt=(i,e=!1)=>{i&&(i.indexOf("global:")>=0?ke(i):i.indexOf("components:")>=0||i.indexOf("group:")==-1&&i.indexOf("combo:")==-1&&i.indexOf("skills:")==-1?(console.log("loading skills"),V(i.replace(`loaded: false
`,""),e)):(console.log("loading classes"),H(i.replace(`loaded: false
`,""),e)))},ft=i=>{const e=new FileReader;i.name.indexOf("skills")==0?e.onload=Ee:i.name.indexOf("classes")==0?e.onload=xe:e.onload=Je,e.readAsText(i)},ut=i=>{const e=i||a(W);e&&K(e.name+".yml",e.serializeYaml().toString())},Qe=()=>{const i=a(v);i.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new c;e.put("loaded",!1);for(const t of i)t.loaded||pe(t),e.put(t.name,t.serializeYaml());return e},Ue=()=>{const i=a(w);i.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new c;e.put("loaded",!1);for(const t of i)t.loaded||ve(t),e.put(t.name,t.serializeYaml());return e},gt=async()=>{const i=Qe(),e=Ue();K("skills.yml",i.toString()),K("classes.yml",e.toString())},K=(i,e)=>{const t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=i,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)},te=f();export{gt as $,$ as A,q as B,oe as C,re as D,le as E,ae as F,$e as G,ot as H,it as I,j as J,g as K,st as L,et as M,tt as N,_e as O,Oe as P,ut as Q,A as R,mt as S,ht as T,Pe as U,C as V,I as W,ee as X,c as Y,Z,at as _,W as a,x as a0,Ye as a1,te as a2,E as a3,u as b,w as c,Me as d,Be as e,S as f,k as g,Y as h,Se as i,U as j,He as k,qe as l,Xe as m,Re as n,Ze as o,y as p,nt as q,Ve as r,v as s,Le as t,rt as u,ce as v,ct as w,pt as x,ft as y,lt as z};
