import{w as u,k as O,l as ue,e as A}from"./singletons.VG7cdh6y.js";import{A as r}from"./scheduler.ProQAdXO.js";const X={INT:/^-?[0-9]+$/,FLOAT:/^-?[0-9]+\.[0-9]+$/,SPACE:/^( +)/},C=n=>{n=n.replace(/\r\n/g,`
`).replace(/\n *\n/g,`
`).replace(/ +\n/g,`
`);const e=new m,t=0,s=n.split(`
`);return e.parse(s,t,0),e},L=n=>{const e=n.match(X.SPACE);return e?e[1].length:0};class fe{data;constructor(e){this.data=e}set=e=>this.data=e;get=()=>this.data}class m{key;data={};constructor(e){this.key=e}put=(e,t)=>{this.data[e]=t};has=e=>this.data[e]!==void 0;get=(e,t,s)=>((this.data[e]=="[]"||this.data[e]==" []")&&(this.data[e]=JSON.parse(this.data[e].trim())),this.has(e)?s?s(this.data[e]):this.data[e]:t);getKeys=()=>Object.keys(this.data);remove=e=>{delete this.data[e]};parse=(e,t,s,i)=>{for(i&&(this.key=i);t<e.length&&L(e[t])>=s;){for(;t<e.length&&(L(e[t])!=s||e[t].replace(/ /g,"").charAt(0)=="#"||e[t].indexOf(":")==-1);)t++;if(t==e.length)break;let o=e[t].substring(s,e[t].indexOf(":"));if(o==="loaded"){t++;continue}if(o.match(/^["'].*["']$/)&&(o=o.substring(1,o.length-1)),!this.key&&!i&&(this.key=o),e[t].search(/: +\{\}/)!=-1&&e[t].length>=4)s===0&&console.log("empty section"),this.data[o]=new m(o);else if(t<e.length-1&&e[t+1].charAt(s)=="-"&&e[t+1].charAt(s+1)==" "&&L(e[t+1])==s){const a=[];for(;++t<e.length&&e[t].charAt(s)=="-";){let l=e[t].substring(s+2);(l.charAt(0)=="'"||l.charAt(0)=='"')&&(l=l.substring(1,l.length-1).replace(/\\(['"])/,c=>c.replace("\\",""))),a.push(l)}this.data[o]=a,t--}else if(t<e.length-1&&L(e[t+1])>s){t++;const a=L(e[t]),l=new m;t=l.parse(e,t,a,o)-1,this.data[o]=l}else{let a=e[t].substring(e[t].indexOf(":")+2);a.charAt(0)=="'"||a.charAt(0)=='"'?a=a.substring(1,a.length-1):isNaN(a)||(X.INT.test(a)?a=parseInt(a):a=parseFloat(a)),typeof a=="string"&&(a.toLowerCase()=="false"?a=!1:a.toLowerCase()=="true"?a=!0:a=a.replace(/\\(['"])/,l=>l.replace("\\",""))),this.data[o]=a}do t++;while(t<e.length&&e[t].replace(/ /g,"").charAt(0)=="#")}return Object.keys(this.data).length==1&&this.key&&this.data[this.key]instanceof m&&(this.data=this.data[this.key].data),t};toString=()=>this.toYaml(this.key||this.data.name?"'"+(this.key||this.data.name)+"'":void 0,this.data);toYaml=(e,t,s=new fe("a"),i="")=>{if(t instanceof m)return t.toYaml("'"+(e??t.key)+"'",t.data,s,i);let o="";e&&(o+=i+e+`:
`,i+="  ");for(const a of Object.keys(t)){const l=t[a];let c="";if(l!=null){if(l instanceof Object)if(Object.keys(l).includes("toYaml"))if(l instanceof m){o+=l.toYaml("'"+a+"'",l.data,s,i);continue}else c=l.toYaml(i);else l instanceof Array&&(c=this.convertArray(a,s,i,l));else{const h=JSON.stringify(l);c=i+a+": "+h+`
`}c&&(o+=c.replaceAll(/(\\)?'/g,"\\'").replaceAll(/((\\)?")/g,h=>h.length==1?"'":h).replaceAll(/\\"/g,'"').replace(/\\\\/g,"\\"))}}return o};nextChar=e=>/z+/.test(e)?e.replaceAll(/z/g,"a")+"a":e.substring(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1);convertArray(e,t,s,i){if(e!="attributes"){let o=s+e+":";if(["string","number"].includes(typeof i[0]))i.length>0?(o+=`
`,i.forEach(a=>o+=s+"- "+JSON.stringify(a)+`
`)):o+=` []
`;else if(e==="components"||e==="children")if(i.length==0)o+=` {}
`;else return o+=`
`,i.forEach(a=>{const l=t.get();t.set(this.nextChar(t.get())),o+=this.toYaml(a.name+"-"+l,a.toYamlObj(),t,s+"  ")}),o.replaceAll(/'/g,'"');else o+=` []
`;return o}else return this.toYaml(e,i,t,s)}}class p{name;base;scale;constructor(e,t,s){this.name=e,this.base=t,this.scale=s}toYaml=(e="")=>e+this.name.toLowerCase()+"-base: "+this.base+`
`+e+this.name.toLowerCase()+"-scale: "+this.scale+`
`}class d{key={};isFolder=!0;open=!1;name="Folder";data=[];parent;constructor(e){e&&(this.data=e,e.forEach(t=>{t instanceof d&&t.isFolder&&t.updateParent(this)}))}updateParent=e=>{this.parent=e};add=e=>{this.data.includes(e)||(e instanceof d&&(Y(e,this.data),Ee(e),e.parent=this),this.data.push(e),this.sort())};remove=e=>{this.data=this.data.filter(t=>t!=e),this.sort()};sort=()=>{this.data=this.data.sort((e,t)=>{let s=0;return e instanceof d&&(t instanceof d||(s=-100)),e.name.localeCompare(t.name)+s}),P()};createFolder=()=>{const e=new d;Y(e,this.data),this.data.push(e),this.sort(),e.updateParent(this)};deleteFolder=e=>{this.data=this.data.filter(t=>t!=e)};contains=e=>{if(this.data.includes(e))return!0;for(const t of this.data.filter(s=>s instanceof d))if(t.contains(e))return!0;return!1};getContainingFolder=e=>{if(this.data.includes(e))return this;for(const t of this.data.filter(s=>s instanceof d)){if(t.data.includes(e))return t;{const s=t.getContainingFolder(e);if(!s)continue;return s}}}}const ge=n=>n.replace("_"," ").toLowerCase().replace(/^(.)|\s(.)/g,e=>e.toUpperCase()),Z=n=>(n=n.replace("_"," "),n.substring(0,1).toUpperCase()+n.substring(1).toLowerCase()),w=n=>n.sort((e,t)=>e.name.localeCompare(t.name)),de=(n,e)=>{let t=e;localStorage.getItem(n)===null&&(typeof e=="string"||typeof e=="number"||typeof e=="boolean"?localStorage.setItem(n,e.toString()):localStorage.setItem(n,JSON.stringify(e))),typeof e=="number"?t=parseInt(localStorage.getItem(n)):typeof e=="boolean"?t=localStorage.getItem(n)==="true":typeof e=="string"?t=localStorage.getItem(n):t=JSON.parse(localStorage.getItem(n));const{subscribe:s,set:i,update:o}=u(t);return{subscribe:s,set:a=>(typeof a=="string"||typeof a=="number"||typeof a=="boolean"?localStorage.setItem(n,a.toString()):localStorage.setItem(n,JSON.stringify(a)),i(a)),update:o}};class we{static new=()=>{throw new Error("'new' method not implemented")}}class ke extends we{type;name;description;comment;components=u([]);data=[];preview=[];enablePreview=!1;summaryItems=[];isParent=!0;isDeprecated=!1;id={};_defaultOpen=!1;parent;constructor(e,t){super(),this.type=e,this.name=t.name,this.description=t.description??"",this.summaryItems=t.summaryItems??[],this.comment=t.comment??"",this.setComponents(t.components||[]),this.data=t.data||[],this.preview=t.preview||[]}getValue(e){const t=this.data?.find(s=>s.key==e);return!t||!t.meetsRequirements(this)?"":t.getSummary()}setComponents=e=>{e.forEach(t=>t.parent=this),this.components.set([...e])};contains=e=>{const t=r(this.components);if(t.includes(e))return!0;for(const s of t)if(s.contains(e))return!0;return!1};addComponent=(e,t=-1)=>{const s=r(this.components);t==-1?s.push(e):s.splice(t,0,e),this.setComponents(s)};removeComponent=e=>{const t=r(this.components);if(t.includes(e)){t.splice(t.indexOf(e),1),e.parent=void 0,this.setComponents(t);return}for(const s of t)s.contains(e)&&s.removeComponent(e)};defaultOpen=()=>(this._defaultOpen=!0,this);toYamlObj(){const e=new m(this.name);if(e.put("type",this.type),e.put("comment",this.comment),this.preview.length>0){const t=new m("preview");t.put("enabled",this.enablePreview),this.preview.filter(s=>s.meetsPreviewRequirements(this)).forEach(s=>{const i=s.getData();Object.keys(i).forEach(o=>t.put(o,i[o]))}),e.put("preview",t)}return e}getRawPreviewData(){const e=new m("preview");return this.preview.forEach(t=>{const s=t.getData();Object.keys(s).forEach(i=>e.put(i,s[i]))}),e}deserialize(e){const t=e.get("preview");t&&(this.enablePreview=t.get("enabled",!1),this.preview.forEach(s=>s.deserialize(t))),this.comment=e.get("comment","").replaceAll("\\n",`
`)}}const _=u({}),ee=u({}),te=u({}),se=u({}),be=u(!1),B=u(""),Se=O([_,B],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),Je=O(Se,n=>{const e={};return n.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e}),Ue=O([ee,B],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),je=O([te,B],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),ve=O([se,B],([n,e])=>Object.keys(n).filter(s=>s.toLowerCase().replace("_"," ").includes(e.toLowerCase())).sort((s,i)=>(n[s].component.new().isDeprecated?0:-1)-(n[i].component.new().isDeprecated?0:-1)).map(s=>n[s])),Ge=O(ve,n=>{const e={};return n.forEach(t=>{let s="General";t.section&&(s=t.section),e[s]||(e[s]=[]),e[s].push(t)}),e});class y{static getTriggerByName=e=>Object.values(r(_)).find(s=>s.name.toLowerCase()===e.toLowerCase())?.component;static getTargetByName=e=>Object.values(r(ee)).find(s=>s.name.toLowerCase()===e.toLowerCase())?.component;static getConditionByName=e=>Object.values(r(te)).find(s=>s.name.toLowerCase()===e.toLowerCase())?.component;static getMechanicByName=e=>Object.values(r(se)).find(s=>s.name.toLowerCase()===e.toLowerCase())?.component;static deserializeComponents=e=>{if(!e||!(e instanceof m))return[];const t=[],s=e.getKeys();for(const i of s){let o;const a=e.get(i),l=a.get("type");if(l==="trigger"){const c=y.getTriggerByName(i.split("-")[0]);c&&(o=c.new())}else if(l==="target"){const c=y.getTargetByName(i.split("-")[0]);c&&(o=c.new())}else if(l==="condition"){const c=y.getConditionByName(i.split("-")[0]);c&&(o=c.new())}else if(l==="mechanic"){const c=y.getMechanicByName(i.split("-")[0]);c&&(o=c.new())}o&&(o.deserialize(a),t.push(o))}return t}}class D extends ke{mana=!1;cooldown=!1;constructor(e,t=!1){super("trigger",e),this.mana=e.mana||!1,this.cooldown=e.cooldown||!1,super.isDeprecated=t}clone=()=>new D({name:this.name,components:[...r(this.components)],mana:this.mana,cooldown:this.cooldown,data:[...this.data],preview:[...this.preview],comment:this.comment,description:this.description,summaryItems:[...this.summaryItems]});toYamlObj(){const e=super.toYamlObj(),t=this.getData();t.getKeys().length>0&&e.put("data",t);const s=r(this.components);return s.length>0&&e.put("children",s),e}getData(){const e=new m("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(e.put("mana",this.mana),e.put("cooldown",this.cooldown)),this.data.filter(t=>t.meetsRequirements(this)).forEach(t=>{const s=t.getData();Object.keys(s).forEach(i=>e.put(i,s[i]))}),e}getRawData(){const e=new m("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(e.put("mana",this.mana),e.put("cooldown",this.cooldown)),this.data.forEach(t=>{const s=t.getData();Object.keys(s).forEach(i=>e.put(i,s[i]))}),e}deserialize(e){super.deserialize(e);const t=e.get("data");t&&(this.mana=t.get("mana",!1),this.cooldown=t.get("cooldown",!1),this.data.forEach(s=>s.deserialize(t))),this.setComponents(e.get("children",[],s=>y.deserializeComponents(s)))}static new=()=>new D({name:"null"})}class b{dataType="skill";location="local";loaded=!1;isSkill=!0;key={};name;previousName="";type="Dynamic";maxLevel=5;skillReq;skillReqLevel=0;attributeRequirements=[];permission=!1;levelReq=new p("level",1,0);cost=new p("cost",1,0);cooldown=new p("cooldown",0,0);cooldownMessage=!0;mana=new p("mana",0,0);minSpent=new p("points-spent-req",0,0);castMessage="&6{player} &2has cast &6{skill}";combo="";icon={material:"Pumpkin",customModelData:0,lore:["&d{name} &7({level}/{max})","&2Type: &6{type}","","{req:level}Level: {attr:level}","{req:cost}Cost: {attr:cost}","","&2Mana: {attr:mana}","&2Cooldown: {attr:cooldown}"]};incompatible=[];triggers=[];skillReqStr="";incompStr=[];constructor(e){this.name=e?.name||"Skill",e&&(e.location&&(this.location=e.location),e.type&&(this.type=e.type),e.maxLevel&&(this.maxLevel=e.maxLevel),e.skillReq&&(this.skillReq=e.skillReq),e.skillReqLevel&&(this.skillReqLevel=e.skillReqLevel),e.attributeRequirements&&(this.attributeRequirements=e.attributeRequirements.map(t=>new p(t.name,t.base,t.scale))),e.permission&&(this.permission=e.permission),e.levelReq&&(this.levelReq=e.levelReq),e.cost&&(this.cost=e.cost),e.cooldown&&(this.cooldown=e.cooldown),e.cooldownMessage&&(this.cooldownMessage=e.cooldownMessage),e.mana&&(this.mana=e.mana),e.minSpent&&(this.minSpent=e.minSpent),e.castMessage&&(this.castMessage=e.castMessage),e.combo&&(this.combo=e.combo),e.icon&&(this.icon=e.icon),e.incompatible&&(this.incompatible=e.incompatible),e.triggers&&(this.triggers=e.triggers))}addComponent=e=>{if(e instanceof D){this.triggers=[...this.triggers,e];return}this.triggers.length===0&&this.triggers.push(y.getTriggerByName("cast")?.new()),this.triggers[0].addComponent(e),this.triggers=[...this.triggers]};removeComponent=e=>{if(e instanceof D&&this.triggers.includes(e)){this.triggers.splice(this.triggers.indexOf(e),1);return}for(const t of this.triggers)t.contains(e)&&t.removeComponent(e);this.triggers=[...this.triggers]};serializeYaml=()=>{const e=new m(this.name),t=new m;t.put("name",this.name),t.put("type",this.type),t.put("max-level",this.maxLevel),t.put("skill-req",this.skillReq?.name),t.put("skill-req-lvl",this.skillReqLevel),t.put("needs-permission",this.permission),t.put("cooldown-message",this.cooldownMessage),t.put("msg",this.castMessage),t.put("combo",this.combo),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore);const s=new m("attributes");return s.put("level",this.levelReq),s.put("cost",this.cost),s.put("cooldown",this.cooldown),s.put("mana",this.mana),s.put("points-spent-req",this.minSpent),s.put("incompatible",this.incompatible.map(i=>i.name)),this.attributeRequirements.forEach(i=>s.put(i.name.toLowerCase(),i)),t.put("attributes",s),t.put("components",this.triggers),e.data=t.data,e};load=e=>{this.name=e.get("name",this.name),this.type=e.get("type",this.type),this.maxLevel=e.get("max-level",this.maxLevel),this.skillReqStr=e.get("skill-req",this.skillReqStr),this.skillReqLevel=e.get("skill-req-lvl",this.skillReqLevel),this.permission=e.get("needs-permission",this.permission),this.cooldownMessage=e.get("cooldown-message",this.cooldownMessage),this.castMessage=e.get("msg",this.castMessage),this.combo=e.get("combo",this.combo);const t=e.get("attributes");this.levelReq=new p("level",t.get("level-base"),t.get("level-scale")),this.cost=new p("cost",t.get("cost-base"),t.get("cost-scale")),this.cooldown=new p("cooldown",t.get("cooldown-base"),t.get("cooldown-scale")),this.mana=new p("mana",t.get("mana-base"),t.get("mana-scale")),this.minSpent=new p("points-spent-req",t.get("points-spent-req-base"),t.get("points-spent-req-scale")),this.incompStr=t.get("incompatible",this.incompStr);const s=["level","cost","cooldown","mana","points-spent-req","incompatible"],i=new Set(t.getKeys().map(a=>a.replace(/-(base|scale)/i,"")).filter(a=>!s.includes(a)));this.attributeRequirements=[...i].map(a=>new p(a,t.get(a+"-base"),t.get(a+"-scale"))),this.icon.material=e.get("icon",this.icon.material,Z),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore);let o;o=be.subscribe(a=>{a&&(this.triggers=e.get("components",this.triggers,l=>y.deserializeComponents(l)),o&&o())}),this.loaded=!0};postLoad=()=>{this.skillReq=I(this.skillReqStr),this.incompatible=this.incompStr.map(e=>I(e)).filter(e=>!!e)};save=()=>{if(!this.name)return;const e=this.serializeYaml();this.location!=="server"&&(this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.skill."+this.previousName),this.previousName=this.name,localStorage.setItem("sapi.skill."+this.name,e.toString()))}}const F=ue("goto");let ne=!1;const Ce=n=>{const e=[],t=C(n);let s;if(t.key&&!t.data[t.key]){const i=t.key;return i==="loaded"||(s=new b({name:i}),s.load(t),e.push(s)),e}for(const i in t.data)i!="loaded"&&t.data[i]instanceof m&&(s=new b({name:i}),s.load(t.data[i]),e.push(s));return e},ie=(n,e,t,s,i)=>{let o=e;{const h=localStorage.getItem(n);h&&(o=t(h),i&&i(o))}const{subscribe:a,set:l,update:c}=u(o);return{subscribe:a,set:h=>(s&&(h=s(h)),l(h)),update:c}},g=ie(localStorage.getItem("skillNames")?"skillNames":"skillData",[],n=>localStorage.getItem("skillNames")?n.split(", ").map(e=>new b({name:e,location:"local"})).filter(e=>localStorage.getItem("sapi.skill."+e.name)):(localStorage.removeItem("skillData"),ne=!0,w(Ce(n))),n=>(oe(),w(n))),I=n=>{for(const e of r(g))if(e.name==n)return e},S=ie("skillFolders",[],n=>!n||n==="null"?[]:JSON.parse(n,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return I(s);const i=new d(s.data);return i.name=s.name,i}return s}}),n=>{const e=JSON.stringify(n,(t,s)=>s instanceof b||s instanceof b?s.name:t==="parent"?void 0:s);return localStorage.setItem("skillFolders",e),w(n)}),q=n=>!!I(n),H=n=>{const e=r(g);let t=e.length+1;for(;!n&&q(n||"Skill "+t);)t++;const s=new b({name:n||"Skill "+t});return e.push(s),g.set(e),s.save(),s},ae=n=>{n.loaded||(n.location==="local"&&n.load(C(localStorage.getItem(`sapi.skill.${n.name}`)||"")),n.postLoad())},Ke=n=>{n.loaded||ae(n);const e=r(g);let t=n.name+" (Copy)",s=1;for(;q(t);)t=n.name+" (Copy "+s+")",s++;const i=new b;return i.load(C(n.serializeYaml().toString())),i.name=t,e.push(i),g.set(e),i.save(),i},Ve=n=>{const e=r(S);e.includes(n)||(Y(n,e),e.push(n),e.sort((t,s)=>t.name.localeCompare(s.name)),S.set(e))},ye=n=>{const e=r(S).filter(t=>t!=n);S.set(e)},Ie=n=>{const e=r(g).filter(s=>s!=n),t=r(N);g.set(e),localStorage.removeItem("sapi.skill."+n.name),t instanceof b&&(e.length===0?F(`${A}/`):e.find(s=>s===r(N))||F(`${A}/skill/${e[0].name}`))},E=()=>g.set(w(r(g))),Oe=()=>{S.set(w(r(S))),E()},G=(n,e=!1)=>{const t=C(n);console.log(t);let s;if(t.key&&!t.data[t.key]){const i=t.key;s=q(i)?I(i):H(i),e&&(s.location="server"),s.load(t),E();return}for(const i in t.data)i!="loaded"&&t.data[i]instanceof m&&!q(i)&&(s=q(i)?I(i):H(i),s.load(t.data[i]));E()},Ne=n=>{const e=n.target?.result;e&&G(e)},J=u(!1);let U;const oe=n=>{r(J)&&U&&clearTimeout(U),J.set(!0),U=setTimeout(()=>{const e=(n||r(g)).filter(t=>t.location==="local");localStorage.setItem("skillNames",e.map(t=>t.name).join(", ")),J.set(!1)})};r(g).forEach(n=>{n.loaded&&n.postLoad()});ne&&(r(g).forEach(n=>{n.location==="local"&&n.save()}),oe());class k{dataType="class";location="local";loaded=!1;isClass=!0;key={};name;previousName="";prefix="";group="class";manaName="&2Mana";maxLevel=40;parentStr="";_parent;get parent(){return this._parent}set parent(e){this._parent=e,this.parentStr=e?e.name:""}permission=!1;expSources=273;manaRegen=1;health=new p("health",20,1);mana=new p("mana",20,1);attributes=[];skillTree="Requirement";skills=[];icon={material:"Pumpkin",customModelData:0};unusableItems=[];actionBar="";constructor(e){this.name=e?e.name:"Class",this.prefix=e?.prefix?e.prefix:"&6"+this.name,e&&(e?.location&&(this.location=e.location),e?.group&&(this.group=e.group),e?.manaName&&(this.manaName=e.manaName),e?.maxLevel&&(this.maxLevel=e.maxLevel),e?.parent&&(this.parent=e.parent),e?.permission&&(this.permission=e.permission),e?.expSources&&(this.expSources=e.expSources),e?.health&&(this.health=e.health),e?.mana&&(this.mana=e.mana),e?.manaRegen&&(this.manaRegen=e.manaRegen),e?.attributes&&(this.attributes=e.attributes),e?.skillTree&&(this.skillTree=e.skillTree),e?.skills&&(this.skills=e.skills),e?.icon&&(this.icon=e.icon),e?.unusableItems&&(this.unusableItems=e.unusableItems),e?.actionBar&&(this.actionBar=e.actionBar))}updateAttributes=e=>{const t=[];this.attributes=this.attributes.filter(s=>e?.includes(s.name)?(t.push(s.name),!0):!1),e=e.filter(s=>!t.includes(s));for(const s of e)this.attributes.push(new p(s,0,0))};serializeYaml=()=>{const e=new m(this.name),t=new m;return t.put("name",this.name),t.put("action-bar",this.actionBar),t.put("prefix",this.prefix),t.put("group",this.group),t.put("mana",this.manaName),t.put("max-level",this.maxLevel),t.put("parent",this.parent?.name||""),t.put("needs-permission",this.permission),t.put("attributes",[this.health,this.mana,...this.attributes]),t.put("mana-regen",this.manaRegen),t.put("skill-tree",this.skillTree.toUpperCase().replace(/ /g,"_")),t.put("blacklist",this.unusableItems),t.put("skills",this.skills.map(s=>s.name)),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore),t.put("exp-source",this.expSources),e.data=t.data,e};updateParent=e=>{this.parentStr&&(this.parent=e.find(t=>t.name===this.parentStr))};load=e=>{this.name=e.get("name",this.name),this.actionBar=e.get("action-bar",this.actionBar),this.manaName=e.get("mana",this.manaName),this.prefix=e.get("prefix",this.prefix),this.group=e.get("group",this.group),this.maxLevel=e.get("max-level",this.maxLevel),this.parentStr=e.get("parent",this.parentStr),this.permission=e.get("needs-permission",this.permission),this.attributes=e.get("attributes",this.attributes,t=>{const s=[],i=t.get("health-base",20),o=t.get("health-scale",1),a=t.get("mana-base",20),l=t.get("mana-scale",1);this.health=new p("health",i,o),this.mana=new p("mana",a,l),t.remove("health-base"),t.remove("health-scale"),t.remove("mana-base"),t.remove("mana-scale");const c={};return Object.keys(t.data).forEach(h=>{const $=h.split("-"),T=$[0];c[T]||(c[T]=new p(T,0,0));const V=c[T];$[1]=="base"&&(V.base=Number.parseFloat(t.data[h])),$[1]=="scale"&&(V.scale=Number.parseFloat(t.data[h]))}),s.push(...Object.values(c)),s}),this.manaRegen=e.get("mana-regen",this.manaRegen),this.skillTree=e.get("skill-tree",this.skillTree,ge),this.unusableItems=e.get("blacklist",this.unusableItems),this.skills=e.get("skills",this.skills,t=>t.map(s=>I(s)).filter(s=>!!s)),this.icon.material=e.get("icon",this.icon.material,Z),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore),this.expSources=e.get("exp-source",this.expSources),this.loaded=!0};save=()=>{if(!this.name||this.location==="server")return;const e=this.serializeYaml();this.previousName&&this.previousName!==this.name&&localStorage.removeItem("sapi.class."+this.previousName),this.previousName=this.name,localStorage.setItem("sapi.class."+this.name,e.toString())}}let re=!1;const Le=n=>{const e=[],t=C(n);let s;if(t.key&&!t.data[t.key]){const i=t.key;return i==="loaded"||(s=new k({name:i}),s.load(t),e.push(s)),e}for(const i in t.data)i!="loaded"&&t.data[i]instanceof m&&(s=new k({name:i}),s.load(t.data[i]),e.push(s));return e},le=(n,e,t,s,i)=>{let o=e;{const h=localStorage.getItem(n);h&&(o=t(h),i&&i(o))}const{subscribe:a,set:l,update:c}=u(o);return{subscribe:a,set:h=>(s&&(h=s(h)),l(h)),update:c}},f=le(localStorage.getItem("classNames")?"classNames":"classData",[],n=>localStorage.getItem("classNames")?n.split(", ").map(e=>new k({name:e,location:"local"})).filter(e=>localStorage.getItem("sapi.class."+e.name)):(localStorage.removeItem("classData"),re=!0,w(Le(n))),n=>(me(n),n.forEach(e=>e.updateParent(n)),w(n)),n=>n.forEach(e=>e.updateParent(n))),x=n=>{for(const e of r(f))if(e.name==n)return e},v=le("classFolders",[],n=>!n||n==="null"?[]:JSON.parse(n,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return x(s);const i=new d(s.data);return i.name=s.name,i}return s}}),n=>{const e=JSON.stringify(n,(t,s)=>s instanceof k||s instanceof b?s.name:t==="parent"?void 0:s);return localStorage.setItem("classFolders",e),w(n)}),Q=n=>r(f).forEach(e=>e.updateAttributes(n)),R=n=>!!x(n),W=n=>{const e=r(f);let t=e.length+1;for(;!n&&R(n||"Class "+t);)t++;const s=new k({name:n||"Class "+t});return e.push(s),f.set(e),s.save(),s},ce=n=>{n.loaded||(n.location==="local"&&n.load(C(localStorage.getItem(`sapi.class.${n.name}`)||"")),n.updateParent(r(f)),n.loaded=!0)},He=n=>{n.loaded||ce(n);const e=r(f);let t=n.name+" (Copy)",s=1;for(;R(t);)t=n.name+" (Copy "+s+")",s++;const i=new k;return i.load(C(n.serializeYaml().toString())),i.name=t,e.push(i),f.set(e),i.save(),i},Qe=n=>{const e=r(v);e.includes(n)||(Y(n,e),e.push(n),e.sort((t,s)=>t.name.localeCompare(s.name)),v.set(e))},qe=n=>{const e=r(v).filter(t=>t!=n);v.set(e)},Re=n=>{const e=r(f).filter(s=>s!=n),t=r(N);f.set(e),localStorage.removeItem("sapi.class."+n.name),t instanceof k&&(e.length===0?F(`${A}/`):e.find(s=>s===r(N))||F(`${A}/class/${e[0].name}/edit`))},M=()=>f.set(w(r(f))),De=()=>{v.set(w(r(v))),M()},K=(n,e=!1)=>{const t=C(n);let s;if(t.key&&!t.data[t.key]){const i=t.key;s=R(i)?x(i):W(i),e&&(s.location="server"),s.load(t),M();return}for(const i in t.data)i!="loaded"&&t.data[i]instanceof m&&!R(i)&&(s=R(i)?x(i):W(i),s.load(t.data[i]));M()},ze=n=>{const e=n.target?.result;e&&K(e)},me=n=>{const e=(n||r(f)).filter(t=>t.location==="local");localStorage.setItem("classNames",e.map(t=>t.name).join(", "))};re&&(r(f).forEach(n=>{n.location==="local"&&n.save()}),me());const Te=(()=>{let n=["vitality","spirit","intelligence","dexterity","strength"];{const i=localStorage.getItem("attribs");i&&(n=i.split(","),Q(n))}const{subscribe:e,set:t,update:s}=u(n);return{subscribe:e,set:i=>(localStorage.setItem("attribs",i.join(",")),Q(i),t(i)),update:s}})(),he=n=>{const e=C(n),t=Object.keys(e.data);Te.set(t)},N=u(void 0),Ae=O(N,n=>n instanceof k?"class":"skill"),We=u(),Xe=u(),z=de("sidebarOpen",!0),Ze=u(!0),pe=u(!0),Fe=u(!1),_e=()=>{r(z)&&(r(Ae)=="class"?M():E(),P())},et=()=>z.set(!r(z)),tt=()=>z.set(!1),st=n=>Fe.set(n),Y=(n,e)=>{const t=n.name;let s=1;for(;e.filter(i=>i instanceof d&&i.name==n.name).length>=1;)n.name=t+" ("+s+++")"},nt=n=>{n.parent?(n.parent.deleteFolder(n),P()):r(pe)?qe(n):ye(n)},it=n=>{n&&(xe(n)?.remove(n),n instanceof k?Re(n):Ie(n),P())},P=()=>{r(z)&&(r(pe)?De():Oe())},Ee=n=>{const e=r(v),t=r(S);e.includes(n)&&v.set(e.filter(s=>s!=n)),t.includes(n)&&S.set(t.filter(s=>s!=n))},xe=n=>{if(!n)return;if(n instanceof d)return n.parent;const e=n instanceof k?r(v):r(S);for(const t of e){const s=t.getContainingFolder(n);if(s)return s}},Me=n=>{const e=n.target?.result;e&&(e.indexOf("global:")>=0?he(e):e.indexOf("components:")>=0||e.indexOf("group:")==-1&&e.indexOf("combo:")==-1&&e.indexOf("skills:")==-1?G(e):K(e),document.activeElement.blur())},at=(n,e=!1)=>{n&&(n.indexOf("global:")>=0?he(n):n.indexOf("components:")>=0||n.indexOf("group:")==-1&&n.indexOf("combo:")==-1&&n.indexOf("skills:")==-1?(console.log("loading skills"),G(n.replace(`loaded: false
`,""),e)):(console.log("loading classes"),K(n.replace(`loaded: false
`,""),e)))},ot=n=>{const e=new FileReader;n.name.indexOf("skills")==0?e.onload=Ne:n.name.indexOf("classes")==0?e.onload=ze:e.onload=Me,e.readAsText(n)},rt=n=>{const e=n||r(N);e&&j(e.name+".yml",e.serializeYaml().toString())},Ye=()=>{const n=r(g);n.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new m;e.put("loaded",!1);for(const t of n)t.loaded||ae(t),e.put(t.name,t.serializeYaml());return e},Be=()=>{const n=r(f);n.sort((t,s)=>t.name>s.name?1:t.name<s.name?-1:0);const e=new m;e.put("loaded",!1);for(const t of n)t.loaded||ce(t),e.put(t.name,t.serializeYaml());return e},lt=async()=>{const n=Ye(),e=Be();j("skills.yml",n.toString()),j("classes.yml",e.toString())},j=(n,e)=>{const t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=n,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)};export{ke as $,Ve as A,He as B,Ke as C,rt as D,it as E,nt as F,Ee as G,v as H,S as I,W as J,H as K,tt as L,J as M,lt as N,z as O,p as P,Fe as Q,C as R,B as S,Ue as T,je as U,ve as V,Ge as W,Xe as X,m as Y,y as Z,Je as _,ot as a,Te as a0,_e as a1,ge as a2,de as a3,Ae as b,N as c,f as d,k as e,x as f,F as g,g as h,b as i,I as j,_ as k,at as l,ee as m,te as n,se as o,be as p,D as q,xe as r,st as s,et as t,Ze as u,We as v,P as w,d as x,pe as y,Qe as z};
